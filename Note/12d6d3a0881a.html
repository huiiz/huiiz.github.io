<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>C&amp;C++ from 于仕琪 南科大 | HUII's Blog</title><meta name="author" content="HUII"><meta name="copyright" content="HUII"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="课程地址：快速学习C和C++，基础语法和优化策略，学了不再怕指针(南科大计算机系原版)_哔哩哔哩_bilibili github地址：ShiqiYu&#x2F;CPP: Lecture notes, projects and other materials for Course ‘CS205 C&#x2F;C++ Program Design’ at Southern University of Science an">
<meta property="og:type" content="article">
<meta property="og:title" content="C&amp;C++ from 于仕琪 南科大">
<meta property="og:url" content="https://blog.huii.top/Note/12d6d3a0881a.html">
<meta property="og:site_name" content="HUII&#39;s Blog">
<meta property="og:description" content="课程地址：快速学习C和C++，基础语法和优化策略，学了不再怕指针(南科大计算机系原版)_哔哩哔哩_bilibili github地址：ShiqiYu&#x2F;CPP: Lecture notes, projects and other materials for Course ‘CS205 C&#x2F;C++ Program Design’ at Southern University of Science an">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.huii.top/img/1676641492749-1024x640.jpg">
<meta property="article:published_time" content="2022-02-17T14:20:00.000Z">
<meta property="article:modified_time" content="2023-10-06T04:02:36.706Z">
<meta property="article:author" content="HUII">
<meta property="article:tag" content="机器学习">
<meta property="article:tag" content="深度学习">
<meta property="article:tag" content="RNN">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.huii.top/img/1676641492749-1024x640.jpg"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://blog.huii.top/Note/12d6d3a0881a.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":128,"position":"top","messagePrev":"本文最后更新于","messageNext":"天前，其中的信息可能已经有所发展或是发生改变。"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: HUII","link":"链接: ","source":"来源: HUII's Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'C&C++ from 于仕琪 南科大',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-06 12:02:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签云</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/1676641492749-1024x640.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="HUII's Blog"><img class="site-icon" src="/img/logo.png"/><span class="site-name">HUII's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签云</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">C&amp;C++ from 于仕琪 南科大</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-17T14:20:00.000Z" title="发表于 2022-02-17 22:20:00">2022-02-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-06T04:02:36.706Z" title="更新于 2023-10-06 12:02:36">2023-10-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Note/">Note</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="C&amp;C++ from 于仕琪 南科大"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>课程地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vf4y1P7pq/">快速学习C和C++，基础语法和优化策略，学了不再怕指针(南科大计算机系原版)_哔哩哔哩_bilibili</a></p>
<p>github地址：<a target="_blank" rel="noopener" href="https://github.com/ShiqiYu/CPP">ShiqiYu/CPP: Lecture notes, projects and other materials for Course ‘CS205 C/C++ Program Design’ at Southern University of Science and Technology. (github.com)</a></p>
<p><img src="../img/1676641492749-1024x640.jpg" alt="img">课程</p>
<p>由于之前已经学过C语言，部分内容将跳过。</p>
<h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="the-first-example"><a href="#the-first-example" class="headerlink" title="the first example"></a>the first example</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//C++ example in C++11</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    vector&lt;string&gt; msg &#123;&quot;Hello&quot;, &quot;C++&quot;, &quot;World&quot;, &quot;!&quot;&#125;;</span><br><span class="line">    </span><br><span class="line">    for (const string&amp; word : msg)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; word &lt;&lt; &quot; &quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用g++进行编译</p>
<p>•Compile hello.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ hello.cpp</span><br></pre></td></tr></table></figure>
<p> •Initialization of msg is a C++11 extension. We need</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ hello.cpp --std=c++11</span><br></pre></td></tr></table></figure>
<p>  •Executable file can be generated as a.out. Change the output filename by -o option</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ hello.cpp --std=c++11 -o hello</span><br></pre></td></tr></table></figure>
<p>•Execute</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./hello</span><br></pre></td></tr></table></figure>
<p>经过测试，windows版本上默认C++选项为c++17，linux上默认为c++14。</p>
<h2 id="编译链接"><a href="#编译链接" class="headerlink" title="编译链接"></a>编译链接</h2><p>当存在3个文件时，先编译，后链接。</p>
<ul>
<li>main.cpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;mul.hpp&quot;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int a, b;</span><br><span class="line">    int result;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;Pick two integers:&quot;;</span><br><span class="line">    cin &gt;&gt; a;</span><br><span class="line">    cin &gt;&gt; b;</span><br><span class="line"></span><br><span class="line">    result = mul(a, b);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;The result is &quot; &lt;&lt; result &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>mul.cpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mul.hpp&quot;</span><br><span class="line"></span><br><span class="line">int mul(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">    return a * b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>mul.hpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">int mul(int a, int b);</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-35-1024x306.png" alt="img">编译链接</p>
<p>也可以一起编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ .\main.cpp .\mul.cpp -o mul</span><br></pre></td></tr></table></figure>
<h2 id="预处理和宏"><a href="#预处理和宏" class="headerlink" title="预处理和宏"></a>预处理和宏</h2><p>•The preprocessor is executed before the compilation.</p>
<p>•Preprocessing directives begin with a # character</p>
<p>•Each directive occupies one line</p>
<p>•preprocessing instruction (define, undef, include, if, ifdef, ifndef, else, elif, endif, line, error, pragma)</p>
<p><img src="../img/image-36-1024x261.png" alt="img">预处理</p>
<p><img src="../img/image-37-1024x261.png" alt="img">宏</p>
<h2 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int main() </span><br><span class="line">&#123;</span><br><span class="line">    /* ... */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以接收参数数组</p>
<ul>
<li>argument.cpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">int main(int argc, char * argv[])</span><br><span class="line">&#123;</span><br><span class="line">    for (int i = 0; i &lt; argc; i++)</span><br><span class="line">        cout &lt;&lt; i &lt;&lt; &quot;: &quot; &lt;&lt; argv[i] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-38.png" alt="img">输入运行结果</p>
<h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="interger"><a href="#interger" class="headerlink" title="interger"></a>interger</h2><p>初始化方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int num;</span><br><span class="line">num = 10;//do not forget this line</span><br><span class="line"></span><br><span class="line">int num = 10;</span><br><span class="line"></span><br><span class="line">int num (10);</span><br><span class="line"></span><br><span class="line">int num &#123;10&#125;;</span><br></pre></td></tr></table></figure>
<p>还可以使用圆括号或花括号进行初始化。</p>
<h2 id="more-interger-types"><a href="#more-interger-types" class="headerlink" title="more interger types"></a>more interger types</h2><h3 id="char"><a href="#char" class="headerlink" title="char"></a>char</h3><p>•char: type for character, 8-bit integer indeed!</p>
<p>•signed char: signed 8-bit integer</p>
<p>•unsinged char: unsigned 8-bit integer</p>
<p>•char: either signed char or unsinged char</p>
<p>char.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    char c1 = &#x27;C&#x27;;</span><br><span class="line">    char c2 = 80;</span><br><span class="line">    char c3 = 0x50;</span><br><span class="line">    char16_t c4 = u&#x27;于&#x27;;</span><br><span class="line">    char32_t c5 = U&#x27;于&#x27;;</span><br><span class="line">    cout &lt;&lt; c1 &lt;&lt; &quot;:&quot; &lt;&lt; c2 &lt;&lt; &quot;:&quot;&lt;&lt; c3 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; +c1 &lt;&lt; &quot;:&quot; &lt;&lt; +c2 &lt;&lt; &quot;:&quot; &lt;&lt; +c3 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; c4 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; c5 &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-39-169651821330212.png" alt="img">输出结果</p>
<h3 id="bool"><a href="#bool" class="headerlink" title="bool"></a>bool</h3><p>•A C++ keyword, but not a C keyword</p>
<p>•bool width: 1 byte (8 bits), NOT 1 bit!</p>
<p>•Value: true (1) or false (0)</p>
<p>长度为1个字节，而不是1位。</p>
<p><strong>bool.cpp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    bool b1 = true;</span><br><span class="line">    int i = b1;</span><br><span class="line">    bool b2 = -256;</span><br><span class="line">    cout &lt;&lt; &quot;i=&quot; &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;b1=&quot; &lt;&lt; b1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;b2=&quot; &lt;&lt; b2 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; true &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-40.png" alt="img">结果</p>
<p>bool非0即1。</p>
<p>在c语言中，c99中，引入stdbool.h头文件即可。</p>
<h3 id="Fixed-width-integer-types"><a href="#Fixed-width-integer-types" class="headerlink" title="Fixed width integer types"></a>Fixed width integer types</h3><p>since C++11</p>
<p><img src="../img/image-41-169651821330215.png" alt="img">cstdint</p>
<p><strong>intmax.cpp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstdint&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;INT8_MAX=&quot; &lt;&lt; INT8_MAX &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-42-169651821330217.png" alt="img">INT8_MAX结果</p>
<h2 id="Floating-point-Numbers"><a href="#Floating-point-Numbers" class="headerlink" title="Floating-point Numbers"></a>Floating-point Numbers</h2><p><strong>float.cpp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;iomanip&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    float f1 = 1.2f;</span><br><span class="line">    float f2 =  f1 * 1000000000000000;</span><br><span class="line">    cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(15) &lt;&lt; f1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; std::fixed &lt;&lt; std::setprecision(15) &lt;&lt; f2 &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-43-169651821330319.png" alt="img">float结果</p>
<p>关于fixed、setprecision等的用法，参见<a target="_blank" rel="noopener" href="https://blog.csdn.net/xian__xian/article/details/114017770">详解C++中fixed，setprecision(),setw()的用法_羡君的博客-CSDN博客_c++ fixed</a></p>
<p>==&gt;浮点数默认保留6位有效数字，但结尾是小数0，则会舍去，使用fixed能取消科学计数法（默认6位小数），使用<strong>setprecision(n)</strong>则可以控制小数保留n位。</p>
<p><img src="../img/image-44-1024x592.png" alt="img">浮点数对比</p>
<h3 id="inf-and-nan"><a href="#inf-and-nan" class="headerlink" title="inf and nan"></a>inf and nan</h3><p><strong>nan.cpp</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    float f1 = 2.0f / 0.0f;</span><br><span class="line">    float f2 = 0.0f / 0.0f;</span><br><span class="line">    cout &lt;&lt; f1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; f2 &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-45.png" alt="img">inf和nan结果</p>
<h2 id="Arithmetic-Operators"><a href="#Arithmetic-Operators" class="headerlink" title="Arithmetic Operators"></a>Arithmetic Operators</h2><p><img src="../img/image-46-1024x540.png" alt="img">类型</p>
<h3 id="auto"><a href="#auto" class="headerlink" title="auto"></a>auto</h3><p>since C++11</p>
<p><img src="../img/image-47-1024x501.png" alt="img">注意</p>
<p>类型初始化时就确定，不会再改变。</p>
<h3 id="Divisions"><a href="#Divisions" class="headerlink" title="Divisions"></a>Divisions</h3><p><img src="../img/image-48-1024x325.png" alt="img">除法</p>
<h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><h2 id="goto-Statement"><a href="#goto-Statement" class="headerlink" title="goto Statement"></a>goto Statement</h2><ul>
<li><p>Jump to the desired location </p>
</li>
<li><p>An unrecommended statement</p>
</li>
</ul>
<p>goto.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">float mysquare(float value)</span><br><span class="line">&#123;</span><br><span class="line">    float result = 0.0f;</span><br><span class="line">    if(value &gt;= 1.0f || value &lt;= 0)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;The input is out of range.&quot; &lt;&lt; endl;</span><br><span class="line">        goto EXIT_ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">    result = value * value;</span><br><span class="line">    return result;</span><br><span class="line">  EXIT_ERROR:</span><br><span class="line">    //do sth such as closing files here</span><br><span class="line">    return 0.0f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h1><h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><p>没有初始化的话，值不确定。</p>
<p>array.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int num_array1[5]; //uninitialized array, random values </span><br><span class="line">    int num_array2[5] = &#123;0, 1, 2, 3, 4&#125;; //initialization</span><br><span class="line"></span><br><span class="line">    for(int idx = 0; idx &lt; 5; idx++)</span><br><span class="line">        cout &lt;&lt; num_array1[idx] &lt;&lt; &quot; &quot;;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    for(int idx = 0; idx &lt; 5; idx++)</span><br><span class="line">        cout &lt;&lt; num_array2[idx] &lt;&lt; &quot; &quot;;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-49.png" alt="img">array</p>
<h3 id="Variable-length-arrays"><a href="#Variable-length-arrays" class="headerlink" title="Variable-length arrays"></a>Variable-length arrays</h3><p>数组长度在运行时确定。</p>
<p>variable-array.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int num_array1[5] = &#123;0,1&#125;; // fixed length array, initialized to &#123;0,1,0,0,0&#125;  </span><br><span class="line">    cout &lt;&lt; &quot;sizeof(num_array1) = &quot; &lt;&lt; sizeof(num_array1) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    int len = 0;</span><br><span class="line">    while ( len &lt; 10 )</span><br><span class="line">    &#123;</span><br><span class="line">        int num_array2[len]; //variable-length array</span><br><span class="line">        cout &lt;&lt; &quot;len = &quot; &lt;&lt; len;</span><br><span class="line">        cout &lt;&lt; &quot;, sizeof(num_array2)) = &quot; &lt;&lt; sizeof(num_array2) &lt;&lt; endl;</span><br><span class="line">        len ++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-50.png" alt="img">变长数组</p>
<p>注意：变长数组不要初始化</p>
<h3 id="Arrays-of-unknown-size"><a href="#Arrays-of-unknown-size" class="headerlink" title="Arrays of unknown size"></a>Arrays of unknown size</h3><p>未知长度数组</p>
<p><img src="../img/image-51-1024x306.png" alt="img">未知长度数组</p>
<h3 id="Element-accessing"><a href="#Element-accessing" class="headerlink" title="Element accessing"></a>Element accessing</h3><p><img src="../img/image-52.png" alt="img">数组读写</p>
<p>注意，c/cpp中不会进行越界检查。</p>
<p>index-bound.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int num_array[5]; </span><br><span class="line"></span><br><span class="line">    for(int idx = -1; idx &lt;= 5; idx++) //out of bounds</span><br><span class="line">        num_array[idx] = idx * idx;</span><br><span class="line"></span><br><span class="line">    for(int idx = -1; idx &lt;= 5; idx++) //out of bounds</span><br><span class="line">        cout &lt;&lt; &quot;num_array[&quot; &lt;&lt; idx &lt;&lt; &quot;] = &quot; &lt;&lt; num_array[idx] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-53.png" alt="img">数组越界</p>
<h3 id="Multidimensional-arrays"><a href="#Multidimensional-arrays" class="headerlink" title="Multidimensional arrays"></a>Multidimensional arrays</h3><p><img src="../img/image-54-1024x374.png" alt="img">多维数组</p>
<h3 id="const-Arrays"><a href="#const-Arrays" class="headerlink" title="const Arrays"></a>const Arrays</h3><p>const-array.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">//float array_sum(const float *values, size_t length)</span><br><span class="line">//float array_sum(const float values[4], size_t length)</span><br><span class="line">float array_sum(const float values[], size_t length)</span><br><span class="line">&#123;</span><br><span class="line">    float sum = 0.0f;</span><br><span class="line">    for (int i = 0; i &lt; length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += values[i];</span><br><span class="line">        //values[i] = 0; //error</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    // const float PI = 3.1415926f;</span><br><span class="line">    // PI += 1.f; // error</span><br><span class="line">    // const float values[4] = &#123;1.1f, 2.2f, 3.3f, 4.4f&#125;;</span><br><span class="line">    // values[0] = 1.0f; // error</span><br><span class="line"></span><br><span class="line">    float values[4] = &#123;1.1f, 2.2f, 3.3f, 4.4f&#125;;</span><br><span class="line">    float sum = array_sum(values, 4);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;sum = &quot; &lt;&lt; sum &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-55.png" alt="img">const array</p>
<p>可以防止对元素进行误操作。</p>
<h2 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h2><h3 id="Array-style-strings"><a href="#Array-style-strings" class="headerlink" title="Array-style strings"></a>Array-style strings</h3><p>•An array-style string (null-terminated strings/arrays of characters) is a series of characters stored in bytes in memory.</p>
<p>•This kind of strings can be declared as follows</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char rabbit[16] = &#123;&#x27;P&#x27;, &#x27;e&#x27;, &#x27;t&#x27;, &#x27;e&#x27;, &#x27;r&#x27;&#125;;</span><br></pre></td></tr></table></figure>
<p>initchar.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    char rabbit[16] = &#123;&#x27;P&#x27;, &#x27;e&#x27;, &#x27;t&#x27;, &#x27;e&#x27;, &#x27;r&#x27;&#125;;</span><br><span class="line">    cout &lt;&lt; &quot;String length is &quot; &lt;&lt; strlen(rabbit) &lt;&lt; endl;</span><br><span class="line">    for(int i = 0; i &lt; 16; i++)</span><br><span class="line">        cout &lt;&lt; i &lt;&lt; &quot;:&quot; &lt;&lt; +rabbit[i] &lt;&lt; &quot;(&quot; &lt;&lt; rabbit[i] &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    char bad_pig[9] = &#123;&#x27;P&#x27;, &#x27;e&#x27;, &#x27;p&#x27;, &#x27;p&#x27;, &#x27;a&#x27;, &#x27; &#x27;, &#x27;P&#x27;, &#x27;i&#x27;, &#x27;g&#x27;&#125;;</span><br><span class="line">    char good_pig[10] = &#123;&#x27;P&#x27;, &#x27;e&#x27;, &#x27;p&#x27;, &#x27;p&#x27;, &#x27;a&#x27;, &#x27; &#x27;, &#x27;P&#x27;, &#x27;i&#x27;, &#x27;g&#x27;, &#x27;\0&#x27;&#125;;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;Rabbit is (&quot; &lt;&lt; rabbit &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;Pig&#x27;s bad name is (&quot; &lt;&lt; bad_pig &lt;&lt; &quot;)&quot; &lt;&lt; endl; </span><br><span class="line">    cout &lt;&lt; &quot;Pig&#x27;s good name is (&quot; &lt;&lt; good_pig &lt;&lt; &quot;)&quot; &lt;&lt; endl; </span><br><span class="line"></span><br><span class="line">    char name[10] = &#123;&#x27;Y&#x27;, &#x27;u&#x27;, &#x27;\0&#x27;, &#x27;S&#x27;, &#x27;.&#x27;, &#x27;0&#x27;&#125;;</span><br><span class="line">    cout &lt;&lt; strlen(name) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-56-169651821330433.png" alt="img">出现多出来的内容</p>
<h3 id="String-literals"><a href="#String-literals" class="headerlink" title="String literals"></a>String literals</h3><p>•It isn’t convenient to initial a string character by character.</p>
<p>•String literals can help.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">char name1[] = &quot;Southern University of Science and Technology&quot;;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-57-1024x235.png" alt="img">定义字符串</p>
<p>字符串操作</p>
<p><img src="../img/image-58-1024x454.png" alt="img">字符串操作</p>
<p>strncpy：拷贝count个，防止越界。</p>
<p>stringop.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    char str1[] = &quot;Hello, \0CPP&quot;;</span><br><span class="line">    char str2[] = &quot;SUSTech&quot;;</span><br><span class="line">    char result[128];</span><br><span class="line"></span><br><span class="line">    for(int i = 0; i &lt; 16; i++)</span><br><span class="line">        cout &lt;&lt; i &lt;&lt; &quot;:&quot; &lt;&lt; +str1[i] &lt;&lt; &quot;(&quot; &lt;&lt; str1[i] &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    strcpy(result, str1);</span><br><span class="line">    cout &lt;&lt; &quot;Result = &quot; &lt;&lt;  result &lt;&lt; endl;</span><br><span class="line">    strcat(result, str2);</span><br><span class="line">    cout &lt;&lt; &quot;Result = &quot; &lt;&lt;  result &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;strcmp() = &quot; &lt;&lt; strcmp(str1, str2) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    //strcat(str1, str2); //danger operation!</span><br><span class="line">    //cout &lt;&lt; &quot;str1 = &quot; &lt;&lt; str1 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-59.png" alt="img">字符串操作</p>
<h3 id="string-class"><a href="#string-class" class="headerlink" title="string class"></a>string class</h3><p>•Null-terminated strings are easy to be out of bound, and to cause problems.</p>
<p>•string class provides functions to manipulate and examinate strings.</p>
<p>stdstring.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    std::string str1 = &quot;Hello&quot;;</span><br><span class="line">    std::string str2 = &quot;SUSTech&quot;;</span><br><span class="line">    std::string result = str1 + &quot;, &quot; + str2;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;result = &quot; + result &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;The length is &quot; &lt;&lt; result.length() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;str1 &lt; str2 is &quot; &lt;&lt; (str1 &lt; str2) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-60.png" alt="img">string类字符串</p>
<p><img src="../img/image-61.png" alt="img">不同的string类</p>
<h2 id="Structures-Unions-and-Enumerations"><a href="#Structures-Unions-and-Enumerations" class="headerlink" title="Structures, Unions and Enumerations"></a>Structures, Unions and Enumerations</h2><h3 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h3><p>struct.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;stdbool.h&gt;</span><br><span class="line"></span><br><span class="line">// typedef </span><br><span class="line">// struct _Student&#123;</span><br><span class="line">//     char name[4];</span><br><span class="line">//     int born;</span><br><span class="line">//     bool male; </span><br><span class="line">// &#125; Student;</span><br><span class="line"></span><br><span class="line">struct Student&#123;</span><br><span class="line">    char name[4];</span><br><span class="line">    int born;</span><br><span class="line">    bool male; </span><br><span class="line">&#125;;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    struct Student stu = &#123;&quot;Yu&quot;, 2000, true&#125;; //initialization</span><br><span class="line">    // strcpy(stu.name, &quot;Yu&quot;);</span><br><span class="line">    // stu.born = 2000;</span><br><span class="line">    // stu.male = true;</span><br><span class="line"></span><br><span class="line">    printf(&quot;Student %s, born in %d, gender %s\n&quot;, </span><br><span class="line">        stu.name, </span><br><span class="line">        stu.born, </span><br><span class="line">        stu.male ? &quot;male&quot; : &quot;female&quot;);</span><br><span class="line"></span><br><span class="line">    struct Student students[100];</span><br><span class="line">    students[50].born = 2002; </span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-64.png" alt="img">结构体结果输出</p>
<p><img src="../img/image-62.png" alt="img">结构体内存</p>
<p>注意：在c语言下，初始化Student要给struct Student，如果要去除struct，则要typeof</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef </span><br><span class="line">struct _Student&#123;</span><br><span class="line">    char name[4];</span><br><span class="line">    int born;</span><br><span class="line">    bool male; </span><br><span class="line">&#125; Student;</span><br></pre></td></tr></table></figure>
<h4 id="Structure-padding"><a href="#Structure-padding" class="headerlink" title="Structure padding"></a>Structure padding</h4><p>•In order to align the data in memory, some empty bytes will be padded</p>
<p><img src="../img/image-63-1024x719.png" alt="img">补齐问题</p>
<p>存储会内存对齐，因此数据顺序不一样，导致占用大小不同，第一个用12字节，第二个用16个字节。</p>
<h4 id="struct-in-C-and-C"><a href="#struct-in-C-and-C" class="headerlink" title="struct in C and C++"></a>struct in C and C++</h4><p>•struct and class in C++ are identical except for several features.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct Student1&#123;</span><br><span class="line">    int id;</span><br><span class="line">    bool male;</span><br><span class="line">    char label;</span><br><span class="line">    float height;</span><br><span class="line">&#125;;</span><br><span class="line">Student1 stu;</span><br><span class="line">stu.id = 123;</span><br></pre></td></tr></table></figure>
<p><strong>No typedef needed in C++!</strong></p>
<h3 id="union"><a href="#union" class="headerlink" title="union"></a>union</h3><p><img src="../img/image-65-1024x518.png" alt="img">结构体</p>
<p>结构体所有成员共享同一内存，大小以最大的为准。一个地址多个名字。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">union ipv4address&#123;</span><br><span class="line">    std::uint32_t address32;</span><br><span class="line">    std::uint8_t address8[4];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    union ipv4address ip;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;sizeof(ip) = &quot; &lt;&lt; sizeof(ip) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    ip.address8[3] = 127;</span><br><span class="line">    ip.address8[2] = 0;</span><br><span class="line">    ip.address8[1] = 0;</span><br><span class="line">    ip.address8[0] = 1;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;The address is &quot; ;</span><br><span class="line">    cout &lt;&lt; +ip.address8[3] &lt;&lt; &quot;.&quot;;</span><br><span class="line">    cout &lt;&lt; +ip.address8[2] &lt;&lt; &quot;.&quot;;</span><br><span class="line">    cout &lt;&lt; +ip.address8[1] &lt;&lt; &quot;.&quot;;</span><br><span class="line">    cout &lt;&lt; +ip.address8[0] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; std::hex;</span><br><span class="line">    cout &lt;&lt; &quot;in hex &quot; &lt;&lt; ip.address32 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-66.png" alt="img">union</p>
<h3 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h3><p><img src="../img/image-67-1024x531.png" alt="img">枚举</p>
<p>enum.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">enum color &#123;WHITE, BLACK, RED, GREEN, BLUE, YELLOW, NUM_COLORS&#125;;</span><br><span class="line">enum datatype &#123;TYPE_INT8=1, TYPE_INT16=2, TYPE_INT32=4, TYPE_INT64=8&#125;;</span><br><span class="line"></span><br><span class="line">struct Point&#123;</span><br><span class="line">    enum datatype type;</span><br><span class="line">    union &#123;</span><br><span class="line">        std::int8_t data8[3];</span><br><span class="line">        std::int16_t data16[3];</span><br><span class="line">        std::int32_t data32[3];</span><br><span class="line">        std::int64_t data64[3];</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">size_t datawidth(struct Point pt)</span><br><span class="line">&#123;</span><br><span class="line">    return size_t(pt.type) * 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int64_t l1norm(struct Point pt)</span><br><span class="line">&#123;</span><br><span class="line">    int64_t result = 0;</span><br><span class="line">    switch(pt.type)</span><br><span class="line">    &#123;</span><br><span class="line">        case (TYPE_INT8): </span><br><span class="line">            result = abs(pt.data8[0]) + abs(pt.data8[1]) + abs(pt.data8[2]);</span><br><span class="line">            break;</span><br><span class="line">        case (TYPE_INT16): </span><br><span class="line">            result = abs(pt.data16[0]) + abs(pt.data16[1]) + abs(pt.data16[2]);</span><br><span class="line">            break;</span><br><span class="line">        case (TYPE_INT32): </span><br><span class="line">            result = abs(pt.data32[0]) + abs(pt.data32[1]) + abs(pt.data32[2]);</span><br><span class="line">            break;</span><br><span class="line">        case (TYPE_INT64): </span><br><span class="line">            result = abs(pt.data64[0]) + abs(pt.data64[1]) + abs(pt.data64[2]);</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    enum color pen_color = RED;</span><br><span class="line">    pen_color = color(3); //convert int to enum</span><br><span class="line">    cout &lt;&lt; &quot;We have &quot; &lt;&lt; NUM_COLORS &lt;&lt; &quot; pens.&quot; &lt;&lt; endl;</span><br><span class="line">    //pen_color += 1; //error!</span><br><span class="line">    int color_index = pen_color;</span><br><span class="line">    color_index += 1;</span><br><span class="line">    cout &lt;&lt; &quot;color_index = &quot; &lt;&lt; color_index &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    //declaration and initialization</span><br><span class="line">    struct Point point1 = &#123;.type=TYPE_INT8, .data8=&#123;-2,3,4&#125;&#125;;</span><br><span class="line">    struct Point point2 = &#123;.type=TYPE_INT32, .data32=&#123;1,-2,3&#125;&#125;;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; &quot;Data width = &quot; &lt;&lt; datawidth(point1) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;Data width = &quot; &lt;&lt; datawidth(point2) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;L1 norm = &quot; &lt;&lt; l1norm(point1) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;L1 norm = &quot; &lt;&lt; l1norm(point2) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="typedef"><a href="#typedef" class="headerlink" title="typedef"></a>typedef</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">typedef int myint;</span><br><span class="line">typedef unsigned char vec3b[3];</span><br><span class="line">typedef struct _rgb_struct&#123; // name _rgb_struct can be omit</span><br><span class="line">    unsigned char r;</span><br><span class="line">    unsigned char g;</span><br><span class="line">    unsigned char b;</span><br><span class="line">&#125;  rgb_struct;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    myint num = 32;</span><br><span class="line"></span><br><span class="line">    // the following two lines are identical</span><br><span class="line">    //unsigned char color[3] = &#123;255, 0, 255&#125;;</span><br><span class="line">    vec3b color = &#123;255, 0, 255&#125;; </span><br><span class="line">    cout &lt;&lt; hex;</span><br><span class="line">    cout &lt;&lt; &quot;R=&quot; &lt;&lt; +color[0] &lt;&lt; &quot;, &quot;;</span><br><span class="line">    cout &lt;&lt; &quot;G=&quot; &lt;&lt; +color[1] &lt;&lt; &quot;, &quot;;</span><br><span class="line">    cout &lt;&lt; &quot;B=&quot; &lt;&lt; +color[2] &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    rgb_struct rgb = &#123;0, 255, 128&#125;;</span><br><span class="line">    cout &lt;&lt; &quot;R=&quot; &lt;&lt; +rgb.r &lt;&lt; &quot;, &quot;;</span><br><span class="line">    cout &lt;&lt; &quot;G=&quot; &lt;&lt; +rgb.g &lt;&lt; &quot;, &quot;;</span><br><span class="line">    cout &lt;&lt; &quot;B=&quot; &lt;&lt; +rgb.b &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; sizeof(rgb.r) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; sizeof(+rgb.r) &lt;&lt; endl; //why 4?</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-68.png" alt="img">代码解释</p>
<h1 id="Week5"><a href="#Week5" class="headerlink" title="Week5"></a>Week5</h1><h2 id="Pointers"><a href="#Pointers" class="headerlink" title="Pointers"></a>Pointers</h2><p>•A pointer is declared like a variable, but with * after the type.</p>
<p>•What stored in a pointer variable is an address.</p>
<p>•Operator &amp; can take the address of an object or a variable of fundamental types. Operator * can take the content that the pointer points to</p>
<p>&amp;取地址，*取内容</p>
<h3 id="Differences-between-a-pointer-and-an-array"><a href="#Differences-between-a-pointer-and-an-array" class="headerlink" title="Differences between a pointer and an array"></a>Differences between a pointer and an array</h3><p>•Array is a constant pointer.</p>
<p>•The total size of all elements in an array can be got by operator sizeof</p>
<p>•sizeof operator to a pointer will return the size of the address (4 or 8)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int numbers[4] = &#123;0, 1, 2, 3&#125;;</span><br><span class="line">int * p = numbers;</span><br><span class="line">cout &lt;&lt; sizeof(numbers) &lt;&lt; endl; //4*sizeof(int)</span><br><span class="line">cout &lt;&lt; sizeof(p) &lt;&lt; endl; // 4 or 8</span><br><span class="line">cout &lt;&lt; sizeof(double *) &lt;&lt; endl; // 4 or 8</span><br></pre></td></tr></table></figure>
<h2 id="Allocate-memory-C-style"><a href="#Allocate-memory-C-style" class="headerlink" title="Allocate memory: C style"></a>Allocate memory: C style</h2><p>动态内存管理</p>
<p><img src="../img/image-69-1024x573.png" alt="img">程序内存</p>
<p>临时局部变量，如<code>int i</code>存放在stack中，而动态申请内存则存放heap中。stack的地址越申请越小，heap的越申请越大。</p>
<p><img src="../img/image-70.png" alt="img">windows下运行结果</p>
<p><img src="../img/image-71.png" alt="img">在Linux下（x86）似乎不符合？</p>
<p><img src="../img/image-72.png" alt="img">在arm的linux（小米平板5pro）运行结果</p>
<h3 id="Memory-allocation"><a href="#Memory-allocation" class="headerlink" title="Memory allocation"></a>Memory allocation</h3><p>•Allocate size bytes of uninitialized storage. <code>void* malloc( size_t size )</code></p>
<p>•Allocate 4 bytes and convert the pointer to (int <em>) explicitly. `int </em> p1 = (int*) malloc (4);`</p>
<p>•对于<code>int * p1 = (int*) malloc (3);</code>申请了3个字节，但可以使用第4个字节，无严重后果。</p>
<h3 id="Memory-deallocation"><a href="#Memory-deallocation" class="headerlink" title="Memory deallocation"></a>Memory deallocation</h3><p><img src="../img/image-73-1024x451.png" alt="img"></p>
<p>哪里申请，哪里释放。</p>
<p>memoryleak.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">void foo()</span><br><span class="line">&#123;</span><br><span class="line">    int* p = (int *) malloc( sizeof(int));</span><br><span class="line">    return;</span><br><span class="line">&#125; //memory leak</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int * p = NULL;</span><br><span class="line">    </span><br><span class="line">    p = (int *) malloc(4 * sizeof(int));</span><br><span class="line">    // some statements</span><br><span class="line">    p = (int *) malloc(8 * sizeof(int));</span><br><span class="line">    // some statements</span><br><span class="line">    free (p);</span><br><span class="line">    // the first memory will not be freed</span><br><span class="line"></span><br><span class="line">    for(int i = 0; i &lt; 1024; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p = (int *) malloc(1024 * 1024 * 1024);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;End\n&quot;);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-74.png" alt="img">运行结果</p>
<p>申请了1T内存，由于操作系统保护机制，程序没有崩掉。</p>
<h2 id="Allocate-memory-C-style-1"><a href="#Allocate-memory-C-style-1" class="headerlink" title="Allocate memory: C++ style"></a>Allocate memory: C++ style</h2><h3 id="Operator-new-and-new"><a href="#Operator-new-and-new" class="headerlink" title="Operator new and new[]"></a>Operator new and new[]</h3><p>•Operator new is similar with malloc() but with more features.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//allocate an int, default initializer (do nothing)</span><br><span class="line">int * p1 = new int; </span><br><span class="line">//allocate an int, initialized to 0</span><br><span class="line">int * p2 = new int();</span><br><span class="line">//allocate an int, initialized to 5</span><br><span class="line">int * p3 = new int(5); </span><br><span class="line">//allocate an int, initialized to 0</span><br><span class="line">int * p4 = new int&#123;&#125;;//C++11 </span><br><span class="line">//allocate an int, initialized to 5</span><br><span class="line">int * p5 = new int &#123;5&#125;;//C++11</span><br><span class="line">//allocate a Student object, default initializer</span><br><span class="line">Student * ps1 = new Student;</span><br><span class="line">//allocate a Student object, initialize the members</span><br><span class="line">Student * ps2 = new Student &#123;&quot;Yu&quot;, 2020, 1&#125;; //C++11</span><br><span class="line">//allocate 16 int, default initializer (do nothing) </span><br><span class="line">int * pa1 = new int[16];</span><br><span class="line">//allocate 16 int, zero initialized </span><br><span class="line">int * pa2 = new int[16]();</span><br><span class="line">//allocate 16 int, zero initialized </span><br><span class="line">int * pa3 = new int[16]&#123;&#125;; //C++11</span><br><span class="line">//allocate 16 int, the first 3 element are initialized to 1,2,3, the rest 0</span><br><span class="line">int * pa4 = new int[16]&#123;1,2,3&#125;; //C++11</span><br><span class="line">//allocate memory for 16 Student objects, default initializer</span><br><span class="line">Student * psa1 = new Student[16];</span><br><span class="line">//allocate memory for 16 Student objects, the first two are explicitly initialized</span><br><span class="line">Student * psa2 = new Student[16]&#123;&#123;&quot;Li&quot;, 2000,1&#125;, &#123;&quot;Yu&quot;, 2001,1&#125;&#125;; //C++11</span><br></pre></td></tr></table></figure>
<h3 id="Operator-delete-and-delete"><a href="#Operator-delete-and-delete" class="headerlink" title="Operator delete and delete[]"></a>Operator delete and delete[]</h3><p>•Destroys object/objects allocated by new and free memory</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//deallocate memory</span><br><span class="line">delete p1;</span><br><span class="line">//deallocate memory</span><br><span class="line">delete ps1;</span><br><span class="line">//deallocate the memory of the array</span><br><span class="line">delete pa1;</span><br><span class="line">//deallocate the memory of the array</span><br><span class="line">delete []pa2;</span><br><span class="line">//deallocate the memory of the array, and call the destructor of the first element</span><br><span class="line">delete psa1;</span><br><span class="line">//deallocate the memory of the array, and call the destructors of all the elements</span><br><span class="line">delete []psa2;</span><br></pre></td></tr></table></figure>
<p>注意，如果数组里是结构体或者对象，<code>delete psa1;</code>只会删除第一个，因此建议写成<code>delete []psa2;</code>。</p>
<h1 id="Week6"><a href="#Week6" class="headerlink" title="Week6"></a>Week6</h1><h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><h3 id="How-are-functions-called"><a href="#How-are-functions-called" class="headerlink" title="How are functions called?"></a>How are functions called?</h3><p><img src="../img/image-75-1024x429.png" alt="img">函数调用</p>
<h2 id="Function-Parameters"><a href="#Function-Parameters" class="headerlink" title="Function Parameters"></a>Function Parameters</h2><p>•The symbolic name for “data” that passes into a function.</p>
<p><strong>Two ways to pass into a function:</strong></p>
<p>•<strong>Pass by value</strong></p>
<p>•<strong>Pass by reference</strong></p>
<h3 id="Pass-by-value-fundamental-type"><a href="#Pass-by-value-fundamental-type" class="headerlink" title="Pass by value: fundamental type"></a>Pass by value: fundamental type</h3><p>•The parameter is a copy of the original variable</p>
<p><img src="../img/image-76-1024x417.png" alt="img">传递拷贝</p>
<h3 id="Pass-by-value-pointer"><a href="#Pass-by-value-pointer" class="headerlink" title="Pass by value: pointer"></a>Pass by value: pointer</h3><p>传递的是地址的拷贝，函数内部指针地址的修改不会影响到外部指针的地址。</p>
<p><img src="../img/image-77-1024x430.png" alt="img">传地址</p>
<h3 id="Pass-by-value-structure"><a href="#Pass-by-value-structure" class="headerlink" title="Pass by value: structure"></a>Pass by value: structure</h3><p><img src="../img/image-78-1024x716.png" alt="img">传递结构体</p>
<p>结构体内容会被拷贝，但是由于pData是指针，修改指向的内容，则原始的也会被修改。</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p>•References are in C++, not in C.</p>
<p>•A reference is an alias to an already-existing variable/object.</p>
<p>相当于别名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int num = 0;</span><br><span class="line">int &amp; num_ref = num;</span><br><span class="line">num_ref = 10;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-79.png" alt="img">引用</p>
<p>•A reference to an object</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Matrix matA = &#123;3,4&#125;;</span><br><span class="line">matA.pData = new float[matA.rows * matA.cols]&#123;&#125;;</span><br><span class="line"></span><br><span class="line">Matrix &amp; matA_ref = matA;</span><br><span class="line"></span><br><span class="line">Matrix * pMatA = &amp;matA;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-80-1024x625.png" alt="img">指针与引用</p>
<p>•A reference must be initialized after its declaration.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int &amp; num_ref; // error </span><br><span class="line">Matrix &amp; mat_ref; // error </span><br></pre></td></tr></table></figure>
<p>• Reference VS Pointer: References are much safer</p>
<p>java中使用引用代替了指针，更加安全。</p>
<h3 id="References-as-function-parameters"><a href="#References-as-function-parameters" class="headerlink" title="References as function parameters"></a>References as function parameters</h3><p>•No data copying in the reference version; Better efficiency The modification to a reference will affect the original object</p>
<p><img src="../img/image-81-1024x444.png" alt="img">引用做函数参数</p>
<h2 id="Inline-functions"><a href="#Inline-functions" class="headerlink" title="Inline functions"></a>Inline functions</h2><p>•Stack operations and jumps are needed for a function call.</p>
<p>•It is a heavy cost for some frequently called tiny functions.</p>
<p><img src="../img/image-82-1024x336.png" alt="img">需要不断跳转</p>
<p>•The generated instructions by a compiler can be as follows to improve efficiency</p>
<p><img src="../img/image-83.png" alt="img">可能指令结果</p>
<p><img src="../img/image-84-1024x404.png" alt="img">建议编译器</p>
<h3 id="Why-not-use-a-macros"><a href="#Why-not-use-a-macros" class="headerlink" title="Why not use a macros?"></a>Why not use a macros?</h3><p>为啥不用宏？<code>#define MAX_MACRO(a, b) (a)&gt;(b) ? (a) : (b)</code></p>
<p>•The source code will be replaced by a preprocessor.</p>
<p>•Surely no cost of a function call,</p>
<p>•And a, b can be any types which can compare.</p>
<p>宏很危险。</p>
<h1 id="Week7"><a href="#Week7" class="headerlink" title="Week7"></a>Week7</h1><p>argument与parameter区别：对<code>float norm(float x, float y, float z = 0);</code>0是<strong>argument</strong>，z则是<strong>parameter</strong>。</p>
<h2 id="Default-Arguments"><a href="#Default-Arguments" class="headerlink" title="Default Arguments"></a>Default Arguments</h2><p>•A feature in C++ (not C).</p>
<p>•To call a function without providing one or more trailing arguments.</p>
<p>默认参数应该在尾部</p>
<p>default-argument.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cmath&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">float norm(float x, float y, float z);</span><br><span class="line">float norm(float x, float y, float z = 0);</span><br><span class="line">float norm(float x, float y = 0, float z);</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; norm(3.0f) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; norm(3.0f, 4.0f) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; norm(3.0f, 4.0f, 5.0f) &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">float norm(float x, float y, float z)</span><br><span class="line">&#123;</span><br><span class="line">    return sqrt(x * x + y * y + z * z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-85.png" alt="img">运行结果</p>
<p>对于<code>float norm(float x, float y = 0, float z);</code>，虽然默认参数不在尾部，但是前面有了个<code>float norm(float x, float y, float z = 0);</code>此时z的默认参数是0。若将这两行对换，或将<strong><code>float norm(float x, float y = 0, float z);</code></strong>中的z再设一个值会报错。</p>
<h2 id="Function-Overloading"><a href="#Function-Overloading" class="headerlink" title="Function Overloading"></a>Function Overloading</h2><p>c++特性</p>
<p><img src="../img/image-86-1024x527.png" alt="img">函数重载</p>
<p>•Which function to choose? The compiler will perform name lookup.</p>
<p>•Argument-dependent lookup, also known as ADL. </p>
<p>The return type will not be considered in name lookup.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">int sum(int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;sum(int, int) is called&quot; &lt;&lt; endl;</span><br><span class="line">    return x + y;</span><br><span class="line">&#125;</span><br><span class="line">float sum(float x, float y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;sum(float, float) is called&quot; &lt;&lt; endl;</span><br><span class="line">    return x + y;</span><br><span class="line">&#125;</span><br><span class="line">double sum(double x, double y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;sum(double, double) is called&quot; &lt;&lt; endl;</span><br><span class="line">    return x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Function-Templates"><a href="#Function-Templates" class="headerlink" title="Function Templates"></a>Function Templates</h2><p>•A function template is not a type, or a function, or any other entity. </p>
<p>•No code is generated from a source file that contains only template definitions.</p>
<p>•The template arguments must be determined, then the compiler can generate an actual function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T&gt;</span><br><span class="line">T sum(T x, T y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;The input type is &quot; &lt;&lt; typeid(T).name() &lt;&lt; endl;</span><br><span class="line">    return x + y;</span><br><span class="line">&#125;</span><br><span class="line">// instantiates sum&lt;double&gt;(double, double)</span><br><span class="line">template double sum&lt;double&gt;(double, double);</span><br><span class="line"></span><br><span class="line">// instantiates sum&lt;char&gt;(char, char), template argument deduced</span><br><span class="line">template char sum&lt;&gt;(char, char); </span><br><span class="line"></span><br><span class="line">// instantiates sum&lt;int&gt;(int, int), template argument deduced</span><br><span class="line">template int sum(int, int); </span><br></pre></td></tr></table></figure>
<p>template也会隐式实例化。</p>
<p>template2.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;typeinfo&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">T sum(T x, T y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;The input type is &quot; &lt;&lt; typeid(T).name() &lt;&lt; endl;</span><br><span class="line">    return x +</span><br><span class="line">     y;</span><br><span class="line">&#125;</span><br><span class="line">// Explicitly instantiate</span><br><span class="line">template double sum&lt;double&gt;(double, double);</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    auto val = sum(4.1, 5.2);</span><br><span class="line">    cout &lt;&lt; val &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-87.png" alt="img">template</p>
<h3 id="Function-template-specialization"><a href="#Function-template-specialization" class="headerlink" title="Function template specialization"></a>Function template specialization</h3><p><img src="../img/image-88-1024x454.png" alt="img">结构体模板加法操作</p>
<p>需要针对特例专门定义函数。</p>
<p>specialization.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;typeinfo&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">T sum(T x, T y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;The input type is &quot; &lt;&lt; typeid(T).name() &lt;&lt; endl;</span><br><span class="line">    return x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct Point</span><br><span class="line">&#123;</span><br><span class="line">    int x;</span><br><span class="line">    int y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Specialization for Point + Point operation</span><br><span class="line">template&lt;&gt;</span><br><span class="line">Point sum&lt;Point&gt;(Point pt1, Point pt2)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;The input type is &quot; &lt;&lt; typeid(pt1).name() &lt;&lt; endl;</span><br><span class="line">    Point pt;</span><br><span class="line">    pt.x = pt1.x + pt2.x;</span><br><span class="line">    pt.y = pt1.y + pt2.y;</span><br><span class="line">    return pt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    //Explicit instantiated functions</span><br><span class="line">    cout &lt;&lt; &quot;sum = &quot; &lt;&lt; sum(1, 2) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;sum = &quot; &lt;&lt; sum(1.1, 2.2) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Point pt1 &#123;1, 2&#125;;</span><br><span class="line">    Point pt2 &#123;2, 3&#125;;</span><br><span class="line">    Point pt = sum(pt1, pt2);</span><br><span class="line">    cout &lt;&lt; &quot;pt = (&quot; &lt;&lt; pt.x &lt;&lt; &quot;, &quot; &lt;&lt; pt.y &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-89.png" alt="img">结果</p>
<p>特例化需要template&lt;&gt;，实例化则不需要&lt;&gt;和函数体。</p>
<h2 id="Function-Pointers-and-References"><a href="#Function-Pointers-and-References" class="headerlink" title="Function Pointers and References"></a>Function Pointers and References</h2><p>函数指针与函数引用</p>
<h3 id="Function-pointers"><a href="#Function-pointers" class="headerlink" title="Function pointers"></a>Function pointers</h3><p>•norm_ptr is a pointer, a function pointer.</p>
<p>•The function should have two float parameters, and returns float.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">float norm_l1(float x, float y);</span><br><span class="line"></span><br><span class="line">float norm_l2(float x, float y); </span><br><span class="line">float (*norm_ptr)(float x, float y); </span><br><span class="line"></span><br><span class="line">norm_ptr = norm_l1; //Pointer norm_ptr is pointing to norm_l1</span><br><span class="line">norm_ptr = &amp;norm_l2; //Pointer norm_ptr is pointing to norm_l2</span><br><span class="line">float len1 = norm_ptr(-3.0f, 4.0f); //function invoked </span><br><span class="line">float len2 = (*norm_ptr)(-3.0f, 4.0f); //function invoked</span><br></pre></td></tr></table></figure>
<p>•A function pointer can be an argument and pass to a function.</p>
<p>将函数传入另一个函数中，作为回调函数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line">void qsort( void *ptr, size_t count, size_t size, </span><br><span class="line">           int (*comp)(const void *, const void *) );</span><br></pre></td></tr></table></figure>
<h3 id="Function-references"><a href="#Function-references" class="headerlink" title="Function references"></a>Function references</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">float norm_l1(float x, float y); //declaration</span><br><span class="line">float norm_l2(float x, float y); //declaration</span><br><span class="line">float (&amp;norm_ref)(float x, float y) = norm_l1; //norm_ref is a function reference</span><br></pre></td></tr></table></figure>
<h2 id="Recursive-Functions"><a href="#Recursive-Functions" class="headerlink" title="Recursive Functions"></a><strong>Recursive Functions</strong></h2><p>递归</p>
<h1 id="Week8"><a href="#Week8" class="headerlink" title="Week8"></a>Week8</h1><h2 id="C-C-with-ARM"><a href="#C-C-with-ARM" class="headerlink" title="C/C++ with ARM"></a>C/C++ with ARM</h2><h2 id="Speedup-Your-Program"><a href="#Speedup-Your-Program" class="headerlink" title="Speedup Your Program"></a>Speedup Your Program</h2><h3 id="Some-Tips-on-Optimization"><a href="#Some-Tips-on-Optimization" class="headerlink" title="Some Tips on Optimization"></a>Some Tips on Optimization</h3><p>•Choose an appropriate algorithm</p>
<p>•Clear and simple code for the compiler to optimize</p>
<p>•Optimize code for memory</p>
<p>•Do not copy large memory</p>
<p>•No printf()/cout in loops</p>
<p>•Table lookup (sin(), cos() …)</p>
<p>•SIMD, OpenMP</p>
<h3 id="SIMD-Single-instruction-multiple-data"><a href="#SIMD-Single-instruction-multiple-data" class="headerlink" title="SIMD: Single instruction, multiple data"></a>SIMD: Single instruction, multiple data</h3><p>一个指令处理多组数组</p>
<p><img src="../img/image-90-1024x465.png" alt="img">SIMD</p>
<h2 id="An-Example-with-SIMD-and-OpenMP"><a href="#An-Example-with-SIMD-and-OpenMP" class="headerlink" title="An Example with SIMD and OpenMP"></a>An Example with SIMD and OpenMP</h2><p><img src="../img/image-91.png" alt="img">arm上运行测试</p>
<p>使用<code>cmake .. -DCMAKE_BUILD_TYPE=Release</code>可以产生release版本。</p>
<p><img src="../img/image-92.png" alt="img">release版本</p>
<p>SIMD+OpenMP计算错误。</p>
<h2 id="Avoid-Memory-Copy"><a href="#Avoid-Memory-Copy" class="headerlink" title="Avoid Memory Copy"></a>Avoid Memory Copy</h2><p><img src="../img/image-94-1024x452.png" alt="img">数据存储</p>
<p>•How many bytes for a row of Matrix 4(row)x3(col)?</p>
<p>ØCan be 3, 4, 8, and any other values &gt;=3.</p>
<p>ØMemory alignment for SIMD</p>
<p><img src="../img/image-93-1024x455.png" alt="img">扣取一个小区域</p>
<h1 id="Week9"><a href="#Week9" class="headerlink" title="Week9"></a>Week9</h1><h2 id="Classes-and-Objects"><a href="#Classes-and-Objects" class="headerlink" title="Classes and Objects"></a>Classes and Objects</h2><h3 id="Structures"><a href="#Structures" class="headerlink" title="Structures"></a>Structures</h3><p><img src="../img/image-95-1024x534.png" alt="img">struct</p>
<h3 id="Classes"><a href="#Classes" class="headerlink" title="Classes"></a>Classes</h3><p><img src="../img/image-96-1024x494.png" alt="img">class</p>
<p>firstclass.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line"></span><br><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    char name[4];</span><br><span class="line">    int born;</span><br><span class="line">    bool male; </span><br><span class="line">    void setName(const char * s)</span><br><span class="line">    &#123;</span><br><span class="line">        strncpy(name, s, sizeof(name));</span><br><span class="line">    &#125;</span><br><span class="line">    void setBorn(int b)</span><br><span class="line">    &#123;</span><br><span class="line">        born = b;</span><br><span class="line">    &#125;</span><br><span class="line">    void setGender(bool isMale)</span><br><span class="line">    &#123;</span><br><span class="line">        male = isMale;</span><br><span class="line">    &#125;</span><br><span class="line">    void printInfo()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Name: &quot; &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; &quot;Born in &quot; &lt;&lt; born &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; &quot;Gender: &quot; &lt;&lt; (male ? &quot;Male&quot; : &quot;Female&quot;) &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Student yu;</span><br><span class="line">    yu.setName(&quot;Yu&quot;);</span><br><span class="line">    yu.setBorn(2000);</span><br><span class="line">    yu.setGender(true);</span><br><span class="line">    yu.born = 2001; // it can also be manipulated directly</span><br><span class="line">    yu.printInfo();</span><br><span class="line">    std::cout &lt;&lt; &quot;It&#x27;s name is &quot; &lt;&lt; yu.name &lt;&lt; std::endl; </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-97.png" alt="img">第一个类</p>
<h3 id="Access-Specifiers"><a href="#Access-Specifiers" class="headerlink" title="Access Specifiers"></a>Access Specifiers</h3><p>•You can protect data members by access specifier private.</p>
<p>•Then data member can only be accessed by well designed member functions.</p>
<p>不写限定符，默认是private</p>
<p>access-attribute.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line"></span><br><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    char name[4];</span><br><span class="line">    int born;</span><br><span class="line">    bool male; </span><br><span class="line">  public:</span><br><span class="line">    void setName(const char * s)</span><br><span class="line">    &#123;</span><br><span class="line">        strncpy(name, s, sizeof(name));</span><br><span class="line">    &#125;</span><br><span class="line">    void setBorn(int b)</span><br><span class="line">    &#123;</span><br><span class="line">        born = b;</span><br><span class="line">    &#125;</span><br><span class="line">    void setGender(bool isMale)</span><br><span class="line">    &#123;</span><br><span class="line">        male = isMale;</span><br><span class="line">    &#125;</span><br><span class="line">    void printInfo()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Name: &quot; &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; &quot;Born in &quot; &lt;&lt; born &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; &quot;Gender: &quot; &lt;&lt; (male ? &quot;Male&quot; : &quot;Female&quot;) &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Student yu;</span><br><span class="line">    yu.setName(&quot;Yu&quot;);</span><br><span class="line">    yu.setBorn(2000);</span><br><span class="line">    yu.setGender(true);</span><br><span class="line">    yu.born = 2001; // you cannot access a private member</span><br><span class="line">    yu.printInfo();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-98-1024x187.png" alt="img">报错</p>
<h3 id="Member-Functions"><a href="#Member-Functions" class="headerlink" title="Member Functions"></a>Member Functions</h3><p><img src="../img/image-99-1024x514.png" alt="img">成员函数</p>
<p>在类内定义的函数，默认是inline。</p>
<p>建议：<strong>简单的适合作为inline的函数可放在类内，其他放在类外。</strong></p>
<p>function.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line"></span><br><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    char name[4];</span><br><span class="line">    int born;</span><br><span class="line">    bool male; </span><br><span class="line">  public:</span><br><span class="line">    void setName(const char * s)</span><br><span class="line">    &#123;</span><br><span class="line">        strncpy(name, s, sizeof(name));</span><br><span class="line">    &#125;</span><br><span class="line">    void setBorn(int b)</span><br><span class="line">    &#123;</span><br><span class="line">        born = b;</span><br><span class="line">    &#125;</span><br><span class="line">    // the declarations, the definitions are out of the class</span><br><span class="line">    void setGender(bool isMale);</span><br><span class="line">    void printInfo();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void Student::setGender(bool isMale)</span><br><span class="line">&#123;</span><br><span class="line">    male = isMale;</span><br><span class="line">&#125;</span><br><span class="line">void Student::printInfo()</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;Name: &quot; &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Born in &quot; &lt;&lt; born &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Gender: &quot; &lt;&lt; (male ? &quot;Male&quot; : &quot;Female&quot;) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Student yu;</span><br><span class="line">    yu.setName(&quot;Yu&quot;);</span><br><span class="line">    yu.setBorn(2000);</span><br><span class="line">    yu.setGender(true);</span><br><span class="line">    yu.printInfo();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="File-Structures"><a href="#File-Structures" class="headerlink" title="File Structures"></a>File Structures</h3><p>•The source code can be placed into multiple files</p>
<p>类定义可放在头文件中</p>
<p><img src="../img/image-100-1024x471.png" alt="img">类放在头文件中</p>
<p>main.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;student.hpp&quot;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Student yu;</span><br><span class="line">    yu.setName(&quot;Yu&quot;);</span><br><span class="line">    yu.setBorn(2000);</span><br><span class="line">    yu.setGender(true);</span><br><span class="line">    yu.printInfo();</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>student.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;student.hpp&quot;</span><br><span class="line"></span><br><span class="line">void Student::setGender(bool isMale)</span><br><span class="line">&#123;</span><br><span class="line">    male = isMale;</span><br><span class="line">&#125;</span><br><span class="line">void Student::printInfo()</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;Name: &quot; &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Born in &quot; &lt;&lt; born &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Gender: &quot; &lt;&lt; (male ? &quot;Male&quot; : &quot;Female&quot;) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>student.hpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    char name[4];</span><br><span class="line">    int born;</span><br><span class="line">    bool male; </span><br><span class="line">  public:</span><br><span class="line">    void setName(const char * s)</span><br><span class="line">    &#123;</span><br><span class="line">        strncpy(name, s, sizeof(name));</span><br><span class="line">    &#125;</span><br><span class="line">    void setBorn(int b)</span><br><span class="line">    &#123;</span><br><span class="line">        born = b;</span><br><span class="line">    &#125;</span><br><span class="line">    // the declarations, the definitions are out of the class</span><br><span class="line">    void setGender(bool isMale);</span><br><span class="line">    void printInfo();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>CMakeLists.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.12)</span><br><span class="line"></span><br><span class="line">project(persondemo)</span><br><span class="line"></span><br><span class="line">ADD_EXECUTABLE(persondemo main.cpp student.cpp)</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-101-1024x611.png" alt="img">运行结果</p>
<h2 id="Constructors-and-Destructors"><a href="#Constructors-and-Destructors" class="headerlink" title="Constructors and Destructors"></a>Constructors and Destructors</h2><h3 id="Constructors"><a href="#Constructors" class="headerlink" title="Constructors"></a>Constructors</h3><ul>
<li><p>Different from struct in C, a constructor will be invoked when creating an object of a class.</p>
<ul>
<li>struct in C: allocate memory</li>
<li>class in C++: allocate memory &amp; invoke a constructor</li>
</ul>
</li>
<li><p>But … No constructor is defined explicitly in previous examples.</p>
<ul>
<li>The compiler will generate one with empty body</li>
</ul>
</li>
</ul>
<p>1、申请内存</p>
<p>2、构造函数</p>
<p>编译器会自动生成空的构造函数</p>
<p>构造函数：</p>
<p><strong>•The same name with the class.</strong></p>
<p><strong>•Have no return value</strong></p>
<p><strong>三种构造函数：</strong></p>
<p>1.无参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Student()</span><br><span class="line">&#123;</span><br><span class="line">    name[0] = 0;</span><br><span class="line">    born = 0;</span><br><span class="line">    male = false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.有参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Student(const char * initName): born(0), male(true)</span><br><span class="line">&#123;</span><br><span class="line">    setName(initName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.跟在后面初始化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Student(const char * initName): born(0), male(true)</span><br><span class="line">&#123;</span><br><span class="line">    setName(initName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>四种初始化</p>
<p>1.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Student yu;</span><br><span class="line">yu.printInfo();</span><br><span class="line">yu.setName(&quot;Yu&quot;);</span><br><span class="line">yu.setBorn(2000);</span><br><span class="line">yu.setGender(true);</span><br><span class="line">yu.printInfo();</span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Student li(&quot;li&quot;);</span><br><span class="line">li.printInfo();</span><br></pre></td></tr></table></figure>
<p>3.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Student xue = Student(&quot;XueQikun&quot;, 1962, true);</span><br><span class="line">//a question: what will happen since &quot;XueQikun&quot; has 4+ characters?</span><br><span class="line">xue.printInfo();</span><br></pre></td></tr></table></figure>
<p>4.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Student * zhou =  new Student(&quot;Zhou&quot;, 1991, false);</span><br><span class="line">zhou-&gt;printInfo();</span><br><span class="line">delete zhou;</span><br></pre></td></tr></table></figure>
<p>其中前三种是在栈上申请，第四种在堆上申请。</p>
<h3 id="Destructors"><a href="#Destructors" class="headerlink" title="Destructors"></a>Destructors</h3><p>•The destructor will be invoked when the object is destroyed.</p>
<p>•Be formed from the class name preceded by a tilde (~)</p>
<p>•Have no return value, no parameters</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">    // ... </span><br><span class="line">  public:</span><br><span class="line">    Student()</span><br><span class="line">    &#123;</span><br><span class="line">        name = new char[1024]&#123;0&#125;;</span><br><span class="line">        born = 0;</span><br><span class="line">        male = false;</span><br><span class="line">        cout &lt;&lt; &quot;Constructor: Person()&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Student()</span><br><span class="line">    &#123;</span><br><span class="line">        delete [] name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>析构函数在该对象的作用域结束时就被销毁了，但是对于动态申请（new）的，需要在delete后才会执行析构函数。</p>
<p>对于数组数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Student * class1 = new Student[3]&#123;</span><br><span class="line">        &#123;&quot;Tom&quot;, 2000, true&#125;,</span><br><span class="line">        &#123;&quot;Bob&quot;, 2001, true&#125;,</span><br><span class="line">        &#123;&quot;Amy&quot;, 2002, false&#125;,</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>如果使用<code>delete class1</code>，只会调用第一个析构函数，而<code>delete []class1</code>则会调用三个析构。</p>
<h2 id="this-Pointer"><a href="#this-Pointer" class="headerlink" title="this Pointer"></a>this Pointer</h2><p>•All methods in a function have a this pointer.</p>
<p>•It is set to the address of the object that invokes the method.</p>
<p>this.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    char * name;</span><br><span class="line">    int born;</span><br><span class="line">    bool male; </span><br><span class="line">  public:</span><br><span class="line">    Student()</span><br><span class="line">    &#123;</span><br><span class="line">        name = new char[1024]&#123;0&#125;;</span><br><span class="line">        born = 0;</span><br><span class="line">        male = false;</span><br><span class="line">        cout &lt;&lt; &quot;Constructor: Person()&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    Student(const char * name, int born, bool male)</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;name =  new char[1024];</span><br><span class="line">        this-&gt;setName(name);</span><br><span class="line">        this-&gt;born = born;</span><br><span class="line">        this-&gt;male = male;</span><br><span class="line">        cout &lt;&lt; &quot;Constructor: Person(const char, int , bool)&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Student()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;To destroy object: &quot; &lt;&lt; name &lt;&lt; endl;</span><br><span class="line">        delete [] name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void setName(const char * name)</span><br><span class="line">    &#123;</span><br><span class="line">        strncpy(this-&gt;name, name, 1024);</span><br><span class="line">    &#125;</span><br><span class="line">    void setBorn(int born)</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;born = born;</span><br><span class="line">    &#125;</span><br><span class="line">    // the declarations, the definitions are out of the class</span><br><span class="line">    void setGender(bool isMale);</span><br><span class="line">    void printInfo();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void Student::setGender(bool isMale)</span><br><span class="line">&#123;</span><br><span class="line">    male = isMale;</span><br><span class="line">&#125;</span><br><span class="line">void Student::printInfo()</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;Name: &quot; &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Born in &quot; &lt;&lt; born &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Gender: &quot; &lt;&lt; (male ? &quot;Male&quot; : &quot;Female&quot;) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Student * class1 = new Student[3]&#123;</span><br><span class="line">        &#123;&quot;Tom&quot;, 2000, true&#125;,</span><br><span class="line">        &#123;&quot;Bob&quot;, 2001, true&#125;,</span><br><span class="line">        &#123;&quot;Amy&quot;, 2002, false&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    class1[1].printInfo();</span><br><span class="line">    delete []class1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="const-and-static-Members"><a href="#const-and-static-Members" class="headerlink" title="const and static Members"></a>const and static Members</h3><h3 id="const-Variables"><a href="#const-Variables" class="headerlink" title="const Variables"></a>const Variables</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#define VALUE 100      // 宏</span><br><span class="line"></span><br><span class="line">const int value = 100; // 值不能再修改</span><br><span class="line">const int * p_int;     // 指针指向的内容不能透过这个指针修改，但是指针地址可以修改</span><br><span class="line">int const * p_int;     // 同上</span><br><span class="line"></span><br><span class="line">int * const p_int;     // 指针地址不能修改，但是可以修改指针指向的内容</span><br><span class="line"></span><br><span class="line">void func(const int *);// 指针</span><br><span class="line">void func(const int &amp;);// 引用</span><br></pre></td></tr></table></figure>
<p>C++中不推荐使用宏。</p>
<h3 id="const-Members"><a href="#const-Members" class="headerlink" title="const Members"></a>const Members</h3><p>•const member variables behavior similar with normal const variables</p>
<p>•const member functions promise not to modify member variables.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    const int BMI = 24;// const变量</span><br><span class="line">    // ...</span><br><span class="line">  public:</span><br><span class="line">    Student()</span><br><span class="line">    &#123;</span><br><span class="line">        BMI = 25;//can it be modified?</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">    int getBorn() const // const函数，不可以去修改成员变量</span><br><span class="line">    &#123;</span><br><span class="line">        born++; //Can it be modified?不可以</span><br><span class="line">        return born;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="static-members"><a href="#static-members" class="headerlink" title="static members"></a>static members</h3><p>•static members are not bound to class instances.</p>
<p>静态成员不绑定到某个实例上。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Student</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    static size_t student_total; // declaration only</span><br><span class="line">  public:</span><br><span class="line">    Student()</span><br><span class="line">    &#123;</span><br><span class="line">        student_total++;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Student()</span><br><span class="line">    &#123;</span><br><span class="line">        student_total--;</span><br><span class="line">    &#125;</span><br><span class="line">    static size_t getTotal() &#123;return student_total;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">// definition it here size_t Student::student_total = 0; </span><br></pre></td></tr></table></figure>
<p><img src="../img/image-5-169651821330980.png" alt="img">静态成员示意图</p>
<p>静态函数不能修改非静态数据。</p>
<h1 id="Week10"><a href="#Week10" class="headerlink" title="Week10"></a>Week10</h1><h2 id="运算符重载Operator-overloading"><a href="#运算符重载Operator-overloading" class="headerlink" title="运算符重载Operator overloading"></a>运算符重载Operator overloading</h2><p><img src="../img/image-14-1024x496.png" alt="img">函数重载</p>
<p>•Implementation of operator+() and operator+=()</p>
<p>time.hpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">class MyTime</span><br><span class="line">&#123;</span><br><span class="line">    int hours;</span><br><span class="line">    int minutes;</span><br><span class="line">  public:</span><br><span class="line">    MyTime(): hours(0), minutes(0)&#123;&#125;</span><br><span class="line">    MyTime(int h, int m): hours(h), minutes(m)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    MyTime operator+(const MyTime &amp; t) const</span><br><span class="line">    &#123;</span><br><span class="line">        MyTime sum;</span><br><span class="line">        sum.minutes = this-&gt;minutes + t.minutes;</span><br><span class="line">        sum.hours = this-&gt;hours + t.hours;</span><br><span class="line"></span><br><span class="line">        sum.hours +=  sum.minutes / 60;</span><br><span class="line">        sum.minutes %= 60;</span><br><span class="line">        </span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line">    MyTime &amp; operator+=(const MyTime &amp; t) </span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;minutes += t.minutes;</span><br><span class="line">        this-&gt;hours += t.hours;</span><br><span class="line"></span><br><span class="line">        this-&gt;hours +=  this-&gt;minutes / 60;</span><br><span class="line">        this-&gt;minutes %= 60;</span><br><span class="line">        </span><br><span class="line">        return *this;</span><br><span class="line">    &#125;</span><br><span class="line">    std::string getTime() const</span><br><span class="line">    &#123;</span><br><span class="line">        return std::to_string(this-&gt;hours) + &quot; hours and &quot; </span><br><span class="line">                + std::to_string(this-&gt;minutes) + &quot; minutes.&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>main.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;time.hpp&quot;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    MyTime t1(2, 40);</span><br><span class="line">    MyTime t2(1, 20);</span><br><span class="line">    std::cout &lt;&lt; (t1 + t2).getTime() &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    t1 += t2; //operator</span><br><span class="line">    t1.operator+=(t2); //function</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; t1.getTime() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-15-169651821330983.png" alt="img">结果</p>
<p><img src="../img/image-16-1024x303.png" alt="img">20+t1?</p>
<h2 id="friend-Functions友元函数"><a href="#friend-Functions友元函数" class="headerlink" title="friend Functions友元函数"></a>friend Functions友元函数</h2><p>•If we want that operator + can support (int + MyTime)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyTime t1(2, 40);</span><br><span class="line">20 + t1;</span><br></pre></td></tr></table></figure>
<p>•Let a friend function to help</p>
<p>•Friend functions</p>
<p> Declare in a class body</p>
<p> Granted class access to members (including private members)</p>
<p> But not members</p>
<p>•Again, friend functions are not members! They just declared in the class body.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class MyTime</span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  public:</span><br><span class="line">    friend MyTime operator+(int m, const MyTime &amp; t)</span><br><span class="line">    &#123;</span><br><span class="line">        return t + m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>t+m调用了另外一个重载。</p>
<p>•A friend function is defined out of the class.</p>
<p>•No MyTime:: before its function name</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class MyTime</span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  public:</span><br><span class="line">    friend MyTime operator+(int m, const MyTime &amp; t);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyTime operator+(int m, const MyTime &amp; t)</span><br><span class="line">&#123;</span><br><span class="line">    return t + m;</span><br><span class="line">&#125;</span><br><span class="line">j</span><br></pre></td></tr></table></figure>
<p>•Operator &lt;&lt; can also be overloaded.</p>
<p>•But in (cout &lt;&lt; t1; ) , the first operand is std::ostream, not MyTime.</p>
<p>•To modify the definition of std::ostream? No!</p>
<p>•Use a friend function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">friend std::ostream &amp; operator&lt;&lt;(std::ostream &amp; os, const MyTime &amp; t)</span><br><span class="line">&#123;</span><br><span class="line">    std::string str = std::to_string(t.hours) + &quot; hours and &quot; </span><br><span class="line">             + std::to_string(t.minutes) + &quot; minutes.&quot;;</span><br><span class="line">    os &lt;&lt; str;</span><br><span class="line">    return os;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;time.hpp&quot;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    MyTime t1(2, 40);</span><br><span class="line">    std::cout &lt;&lt; (30 + t1).getTime() &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; t1 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;Please input two integers:&quot; &lt;&lt; std::endl;</span><br><span class="line">    std::cin &gt;&gt; t1;</span><br><span class="line">    std::cout &lt;&lt; t1 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>time.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">class MyTime</span><br><span class="line">&#123;</span><br><span class="line">    int hours;</span><br><span class="line">    int minutes;</span><br><span class="line">  public:</span><br><span class="line">    MyTime(): hours(0), minutes(0)&#123;&#125;</span><br><span class="line">    MyTime(int h, int m): hours(h), minutes(m)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    MyTime operator+(const MyTime &amp; t) const</span><br><span class="line">    &#123;</span><br><span class="line">        MyTime sum;</span><br><span class="line">        sum.minutes = this-&gt;minutes + t.minutes;</span><br><span class="line">        sum.hours = this-&gt;hours + t.hours;</span><br><span class="line"></span><br><span class="line">        sum.hours +=  sum.minutes / 60;</span><br><span class="line">        sum.minutes %= 60;</span><br><span class="line">        </span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line">    MyTime &amp; operator+=(const MyTime &amp; t) </span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;minutes += t.minutes;</span><br><span class="line">        this-&gt;hours += t.hours;</span><br><span class="line"></span><br><span class="line">        this-&gt;hours +=  this-&gt;minutes / 60;</span><br><span class="line">        this-&gt;minutes %= 60;</span><br><span class="line">        </span><br><span class="line">        return *this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MyTime operator+(int m) const</span><br><span class="line">    &#123;</span><br><span class="line">        MyTime sum;</span><br><span class="line">        sum.minutes = this-&gt;minutes + m;</span><br><span class="line">        sum.hours = this-&gt;hours;</span><br><span class="line">        sum.hours +=  sum.minutes / 60;</span><br><span class="line">        sum.minutes %= 60;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    friend MyTime operator+(int m, const MyTime &amp; t)</span><br><span class="line">    &#123;</span><br><span class="line">        return t + m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::string getTime() const</span><br><span class="line">    &#123;</span><br><span class="line">        return std::to_string(this-&gt;hours) + &quot; hours and &quot; </span><br><span class="line">                + std::to_string(this-&gt;minutes) + &quot; minutes.&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    friend std::ostream &amp; operator&lt;&lt;(std::ostream &amp; os, const MyTime &amp; t)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string str = std::to_string(t.hours) + &quot; hours and &quot; </span><br><span class="line">                        + std::to_string(t.minutes) + &quot; minutes.&quot;;</span><br><span class="line">        os &lt;&lt; str;</span><br><span class="line">        return os;</span><br><span class="line">    &#125;</span><br><span class="line">    friend std::istream &amp; operator&gt;&gt;(std::istream &amp; is, MyTime &amp; t)</span><br><span class="line">    &#123;</span><br><span class="line">        is &gt;&gt; t.hours &gt;&gt; t.minutes;</span><br><span class="line">        t.hours +=  t.minutes / 60;</span><br><span class="line">        t.minutes %= 60;</span><br><span class="line">        return is;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-17-169651821330986.png" alt="img">结果</p>
<p>一些理解：</p>
<p>os是输出流，<code>os **&lt;&lt;** str;</code>要将str的内容送入输出流；</p>
<p>is是输入流，<code>is **&gt;&gt;** t.hours **&gt;&gt;** t.minutes;</code>则是要分别将输入流内容放入hours和minutes中。</p>
<h2 id="User-defined-Type-Conversion"><a href="#User-defined-Type-Conversion" class="headerlink" title="User-defined Type Conversion"></a>User-defined Type Conversion</h2><h3 id="operator-type"><a href="#operator-type" class="headerlink" title="operator type()"></a>operator type()</h3><p>•Overloaded type conversion: convert the current type to another</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//implicit conversion</span><br><span class="line">operator int() const</span><br><span class="line">&#123;</span><br><span class="line">    return this-&gt;hours * 60 + this-&gt;minutes;</span><br><span class="line">&#125;</span><br><span class="line">//explicit conversion</span><br><span class="line">explicit operator float() const</span><br><span class="line">&#123;</span><br><span class="line">    return float(this-&gt;hours * 60 + this-&gt;minutes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>explicit</strong> 表示必须进行显式的类型转换。</p>
<p><img src="../img/image-18.png" alt="img">隐式与显式类型转换</p>
<h3 id="Converting-constructor"><a href="#Converting-constructor" class="headerlink" title="Converting constructor"></a>Converting constructor</h3><p>构造函数</p>
<p>•Convert another type to the current</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MyTime(int m): hours(0), minutes(m)</span><br><span class="line">&#123;</span><br><span class="line">    this-&gt;hours += this-&gt;minutes / 60;</span><br><span class="line">    this-&gt;minutes %= 60;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-19-169651821330989.png" alt="img">结果</p>
<h3 id="Assignment-operator-overloading"><a href="#Assignment-operator-overloading" class="headerlink" title="Assignment operator overloading"></a>Assignment operator overloading</h3><p>对等号进行了重载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MyTime &amp; operator=(int m)</span><br><span class="line">&#123;</span><br><span class="line">    this-&gt;hours = 0;</span><br><span class="line">    this-&gt;minutes = m;</span><br><span class="line">    this-&gt;hours = this-&gt;minutes / 60;</span><br><span class="line">    this-&gt;minutes %= 60;</span><br><span class="line">    return *this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-20-169651821330991.png" alt="img">结果</p>
<p>上面这两个，一个是初始化，一个是赋值。</p>
<h2 id="Increment-and-decrement-operators"><a href="#Increment-and-decrement-operators" class="headerlink" title="Increment and decrement operators"></a>Increment and decrement operators</h2><p>分别是前置操作与后置操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// prefix increment</span><br><span class="line">MyTime&amp; operator++()</span><br><span class="line">&#123;</span><br><span class="line">    this-&gt;minutes++;</span><br><span class="line">    this-&gt;hours += this-&gt;minutes / 60;</span><br><span class="line">    this-&gt;minutes = this-&gt;minutes % 60;</span><br><span class="line">    return *this; </span><br><span class="line">&#125;</span><br><span class="line">// postfix increment</span><br><span class="line">MyTime operator++(int)</span><br><span class="line">&#123;</span><br><span class="line">    MyTime old = *this; // keep the old value</span><br><span class="line">    operator++(); // prefix increment</span><br><span class="line">    return old; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可重载符号</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>+</th>
<th>%</th>
<th>~</th>
<th>&gt;</th>
<th>/=</th>
<th>&lt;&lt;</th>
<th>==</th>
<th>&lt;=&gt;</th>
<th>—</th>
<th>()</th>
</tr>
</thead>
<tbody>
<tr>
<td>-</td>
<td>^</td>
<td>!</td>
<td>+=</td>
<td>%=</td>
<td>&gt;&gt;</td>
<td>!=</td>
<td>&amp;&amp;</td>
<td>,</td>
<td>[]</td>
</tr>
<tr>
<td>*</td>
<td>&amp;</td>
<td>=</td>
<td>-=</td>
<td>&amp;=</td>
<td>&lt;&lt;=</td>
<td>&lt;=</td>
<td>\</td>
<td>\</td>
<td></td>
<td>-&gt;*</td>
<td></td>
</tr>
<tr>
<td>/</td>
<td>\</td>
<td></td>
<td>&lt;</td>
<td>*=</td>
<td>\</td>
<td>=</td>
<td>&gt;&gt;=</td>
<td>&gt;=</td>
<td>++</td>
<td>-&gt;</td>
</tr>
</tbody>
</table>
</div>
<p>可重载</p>
<h1 id="Week11"><a href="#Week11" class="headerlink" title="Week11"></a>Week11</h1><h2 id="Some-Default-Operations"><a href="#Some-Default-Operations" class="headerlink" title="Some Default Operations"></a>Some Default Operations</h2><h3 id="Default-Constructors"><a href="#Default-Constructors" class="headerlink" title="Default Constructors"></a>Default Constructors</h3><p>Default constructor: a constructor which can be called without arguments<br>If you define no constructors, the compiler automatically provide one</p>
<p>如果没有构造任何一个构造函数，则会自动生成，否则不会生成。</p>
<p>默认构造函数是无参数的。</p>
<p><img src="../img/image-21-1024x424.png" alt="img">构造函数</p>
<h3 id="Implicitly-defined-Destructor"><a href="#Implicitly-defined-Destructor" class="headerlink" title="Implicitly-defined Destructor"></a>Implicitly-defined Destructor</h3><p><img src="../img/image-22-1024x212.png" alt="img">析构函数</p>
<h3 id="Default-Copy-Constructors"><a href="#Default-Copy-Constructors" class="headerlink" title="Default Copy Constructors"></a>Default Copy Constructors</h3><p><img src="../img/image-23-1024x168.png" alt="img">默认拷贝构造函数</p>
<p>Default copy constructor:</p>
<ul>
<li>If no user-defined copy constructors, the compiler will generate one.</li>
<li>Copy all non-static data members.</li>
</ul>
<p>自动会把非静态成员拷贝一遍。</p>
<h3 id="Default-Copy-Assignment"><a href="#Default-Copy-Assignment" class="headerlink" title="Default Copy Assignment"></a>Default Copy Assignment</h3><p><img src="../img/image-24-1024x475.png" alt="img">拷贝赋值</p>
<h2 id="An-Example-with-Dynamic-Memory"><a href="#An-Example-with-Dynamic-Memory" class="headerlink" title="An Example with Dynamic Memory"></a>An Example with Dynamic Memory</h2><ul>
<li>mystring.hpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line"></span><br><span class="line">class MyString</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    int buf_len;</span><br><span class="line">    char * characters;</span><br><span class="line">  public:</span><br><span class="line">    MyString(int buf_len = 64, const char * data = NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Constructor(int, char*)&quot; &lt;&lt; std::endl;</span><br><span class="line">        this-&gt;buf_len = 0;</span><br><span class="line">        this-&gt;characters = NULL;</span><br><span class="line">        create(buf_len, data);</span><br><span class="line">    &#125;</span><br><span class="line">    ~MyString()</span><br><span class="line">    &#123;</span><br><span class="line">        delete []this-&gt;characters;</span><br><span class="line">    &#125;</span><br><span class="line">    bool create(int buf_len,  const char * data)</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;buf_len = buf_len;</span><br><span class="line"></span><br><span class="line">        if( this-&gt;buf_len != 0)</span><br><span class="line">        &#123;</span><br><span class="line">            this-&gt;characters = new char[this-&gt;buf_len]&#123;&#125;;</span><br><span class="line">            if(data)</span><br><span class="line">                strncpy(this-&gt;characters, data, this-&gt;buf_len);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    friend std::ostream &amp; operator&lt;&lt;(std::ostream &amp; os, const MyString &amp; ms)</span><br><span class="line">    &#123;</span><br><span class="line">        os &lt;&lt; &quot;buf_len = &quot; &lt;&lt; ms.buf_len;</span><br><span class="line">        os &lt;&lt; &quot;, characters = &quot; &lt;&lt; static_cast&lt;void*&gt;(ms.characters);</span><br><span class="line">        os &lt;&lt; &quot; [&quot; &lt;&lt; ms.characters &lt;&lt; &quot;]&quot;;</span><br><span class="line">        return os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>main.cpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &quot;mystring.hpp&quot;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">// Why memory leak and memory double free?</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    MyString str1(10, &quot;Shenzhen&quot;);</span><br><span class="line">    cout &lt;&lt; &quot;str1: &quot; &lt;&lt; str1 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    MyString str2 = str1; </span><br><span class="line">    cout &lt;&lt; &quot;str2: &quot; &lt;&lt; str2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    MyString str3;</span><br><span class="line">    cout &lt;&lt; &quot;str3: &quot; &lt;&lt; str3 &lt;&lt; endl;</span><br><span class="line">    str3 = str1;</span><br><span class="line">    cout &lt;&lt; &quot;str3: &quot; &lt;&lt; str3 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-28-1024x265.png" alt="img">出现错误提示</p>
<p>问题：</p>
<ol>
<li>str3原来申请的内存没有被释放</li>
<li>str2和str3的析构函数对已释放的内存又进行释放</li>
</ol>
<p><img src="../img/image-29-1024x514.png" alt="img">结构</p>
<h2 id="Solution-1-Hard-Copy"><a href="#Solution-1-Hard-Copy" class="headerlink" title="Solution 1: Hard Copy"></a>Solution 1: Hard Copy</h2><p>实现自定义的拷贝函数，不再共享内存。</p>
<ul>
<li>mystring.hpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstring&gt;</span><br><span class="line"></span><br><span class="line">class MyString</span><br><span class="line">&#123;</span><br><span class="line">  private:</span><br><span class="line">    int buf_len;</span><br><span class="line">    char * characters;</span><br><span class="line">  public:</span><br><span class="line">    MyString(int buf_len = 64, const char * data = NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Constructor(int, char*)&quot; &lt;&lt; std::endl;</span><br><span class="line">        this-&gt;buf_len = 0;</span><br><span class="line">        this-&gt;characters = NULL;</span><br><span class="line">        create(buf_len, data);</span><br><span class="line">    &#125;</span><br><span class="line">    ~MyString()</span><br><span class="line">    &#123;</span><br><span class="line">        delete []this-&gt;characters;</span><br><span class="line">    &#125;</span><br><span class="line">    bool create(int buf_len,  const char * data)</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;buf_len = buf_len;</span><br><span class="line"></span><br><span class="line">        if( this-&gt;buf_len != 0)</span><br><span class="line">        &#123;</span><br><span class="line">            this-&gt;characters = new char[this-&gt;buf_len]&#123;&#125;;</span><br><span class="line">            if(data)</span><br><span class="line">                strncpy(this-&gt;characters, data, this-&gt;buf_len);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    friend std::ostream &amp; operator&lt;&lt;(std::ostream &amp; os, const MyString &amp; ms)</span><br><span class="line">    &#123;</span><br><span class="line">        os &lt;&lt; &quot;buf_len = &quot; &lt;&lt; ms.buf_len;</span><br><span class="line">        os &lt;&lt; &quot;, characters = &quot; &lt;&lt; static_cast&lt;void*&gt;(ms.characters);</span><br><span class="line">        os &lt;&lt; &quot; [&quot; &lt;&lt; ms.characters &lt;&lt; &quot;]&quot;;</span><br><span class="line">        return os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Solution-2-Soft-Copy"><a href="#Solution-2-Soft-Copy" class="headerlink" title="Solution 2: Soft Copy"></a>Solution 2: Soft Copy</h2><p>Problem of Hard Copy</p>
<p>•Frequently allocate and free memory.</p>
<p>•Time consuming when the memory is big.</p>
<p>But…</p>
<p>•If several objects share the same memory, who should release it?</p>
<p><img src="../img/image-30-1024x424.png" alt="img">opencv</p>
<h2 id="Smart-Pointers"><a href="#Smart-Pointers" class="headerlink" title="Smart Pointers"></a>Smart Pointers</h2><h3 id="std-shared-ptr"><a href="#std-shared-ptr" class="headerlink" title="std::shared_ptr"></a>std::shared_ptr</h3><p>允许一个地址被多个指针指向</p>
<p><img src="../img/image-31-1024x299.png" alt="img">std::shared_ptr</p>
<h3 id="std-unique-ptr"><a href="#std-unique-ptr" class="headerlink" title="std::unique_ptr"></a>std::unique_ptr</h3><p>只允许一个指针指向</p>
<p><img src="../img/image-32-1024x289.png" alt="img">std::unique_ptr</p>
<ul>
<li>unique_ptr.cpp</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line"></span><br><span class="line">class MyTime</span><br><span class="line">&#123;</span><br><span class="line">    int hours;</span><br><span class="line">    int minutes;</span><br><span class="line">  public:</span><br><span class="line">    MyTime(): hours(0), minutes(0)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Constructor MyTime()&quot; &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    MyTime(int m): hours(0), minutes(m)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Constructor MyTime(int)&quot; &lt;&lt; std::endl;</span><br><span class="line">        this-&gt;hours +=  this-&gt;minutes / 60;</span><br><span class="line">        this-&gt;minutes %= 60;</span><br><span class="line">    &#125;</span><br><span class="line">    MyTime(int h, int m): hours(h), minutes(m)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Constructor MyTime(int,int)&quot; &lt;&lt; std::endl;</span><br><span class="line">        this-&gt;hours +=  this-&gt;minutes / 60;</span><br><span class="line">        this-&gt;minutes %= 60;</span><br><span class="line">    &#125;</span><br><span class="line">    ~MyTime()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;Destructor MyTime(). Bye!&quot; &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    MyTime operator+(int m) const</span><br><span class="line">    &#123;</span><br><span class="line">        MyTime sum;</span><br><span class="line">        sum.minutes = this-&gt;minutes + m;</span><br><span class="line">        sum.hours = this-&gt;hours;</span><br><span class="line">        sum.hours +=  sum.minutes / 60;</span><br><span class="line">        sum.minutes %= 60;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line">    friend std::ostream &amp; operator&lt;&lt;(std::ostream &amp; os, const MyTime &amp; t)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string str = std::to_string(t.hours) + &quot; hours and &quot; </span><br><span class="line">                        + std::to_string(t.minutes) + &quot; minutes.&quot;;</span><br><span class="line">        os &lt;&lt; str;</span><br><span class="line">        return os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    std::unique_ptr&lt;MyTime&gt; mt1(new MyTime(10));</span><br><span class="line">    std::unique_ptr&lt;MyTime&gt; mt2 = std::make_unique&lt;MyTime&gt;(80); //c++17</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; &quot;mt1: &quot; &lt;&lt;*mt1 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;mt2: &quot; &lt;&lt;*mt2 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    // std::unique_ptr&lt;MyTime&gt; mt3 = mt1; // error</span><br><span class="line">    std::unique_ptr&lt;MyTime&gt; mt3 = std::move(mt1); </span><br><span class="line">    // std::shared_ptr&lt;MyTime&gt; mt3 = std::move(mt1);//okay</span><br><span class="line">    </span><br><span class="line">    // std::cout &lt;&lt; &quot;mt1: &quot; &lt;&lt;*mt1 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; &quot;mt3: &quot; &lt;&lt;*mt3 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="How-to-Understand-Smart-Pointers"><a href="#How-to-Understand-Smart-Pointers" class="headerlink" title="How to Understand Smart Pointers"></a>How to Understand Smart Pointers</h3><p><img src="../img/image-33-1024x461.png" alt="img">smart pointer</p>
<h1 id="Week12"><a href="#Week12" class="headerlink" title="Week12"></a>Week12</h1><h2 id="Improve-Your-Source-Code"><a href="#Improve-Your-Source-Code" class="headerlink" title="Improve Your Source Code"></a>Improve Your Source Code</h2><p>•Use size_t for mat.cols and mat.rows</p>
<p>•Use memcpy() to copy data. Element assignment has a lower efficiency.</p>
<p>•Use 1D array (float<em>) nor 2D array (float*</em>) for matrix data.</p>
<p>•Redundant computation in loops</p>
<p>•Do parameter checking in functions: null pointers, dimension matching in matrix operations, etc</p>
<p>•Do not bind the create matrix function with file I/O.</p>
<p>•File name: head.h, source1.c, source2.c, source3.c</p>
<p>•Good implementation VS good homework. </p>
<h2 id="Derived-Classes派生类"><a href="#Derived-Classes派生类" class="headerlink" title="Derived Classes派生类"></a>Derived Classes派生类</h2><h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><p><img src="../img/image-34-1024x512.png" alt="img">继承</p>
<h3 id="Constructors-1"><a href="#Constructors-1" class="headerlink" title="Constructors"></a>Constructors</h3><p>•To instantiate a derived class object</p>
<ul>
<li><p>Allocate memory</p>
</li>
<li><p>Derived constructor is invoked</p>
<ul>
<li>Base object is constructed by a base constructor</li>
<li>Member initializer list initializes members </li>
<li>To execute the body of the derived constructor</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Derived: public Base</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    int c;</span><br><span class="line">    Derived(int c): Base(c - 2, c - 1), c(c)</span><br><span class="line">    &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>先执行父类的构造函数，再执行子类的构造函数。</p>
<h3 id="Destructors-1"><a href="#Destructors-1" class="headerlink" title="Destructors"></a>Destructors</h3><p>•The destructor of the derived class is invoked first,</p>
<p>•Then the destructor of the base class.</p>
<p>derive.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Base</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    int a;</span><br><span class="line">    int b;</span><br><span class="line">    Base(int a = 0, int b = 0)</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;a = a;</span><br><span class="line">        this-&gt;b = b;</span><br><span class="line">        cout &lt;&lt; &quot;Constructor Base::Base(&quot; &lt;&lt; a &lt;&lt; &quot;, &quot; &lt;&lt; b &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Base()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Destructor Base::~Base()&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    int product()</span><br><span class="line">    &#123;</span><br><span class="line">        return a * b;</span><br><span class="line">    &#125;</span><br><span class="line">    friend std::ostream &amp; operator&lt;&lt;(std::ostream &amp; os, const Base &amp; obj)</span><br><span class="line">    &#123;</span><br><span class="line">        os &lt;&lt; &quot;Base: a = &quot; &lt;&lt; obj.a &lt;&lt; &quot;, b = &quot; &lt;&lt; obj.b;</span><br><span class="line">        return os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Derived: public Base</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    int c;</span><br><span class="line">    Derived(int c): Base(c - 2, c - 1), c(c)</span><br><span class="line">    &#123;</span><br><span class="line">        this-&gt;a += 3; //it can be changed after initialization</span><br><span class="line">        cout &lt;&lt; &quot;Constructor Derived::Derived(&quot; &lt;&lt; c &lt;&lt; &quot;)&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Derived()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Destructor Derived::~Derived()&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    int product()</span><br><span class="line">    &#123;</span><br><span class="line">        return Base::product() * c;</span><br><span class="line">    &#125;</span><br><span class="line">    friend std::ostream &amp; operator&lt;&lt;(std::ostream &amp; os, const Derived &amp; obj)</span><br><span class="line">    &#123;</span><br><span class="line">        // call the friend function in Base class</span><br><span class="line">        os &lt;&lt; static_cast&lt;const Base&amp;&gt;(obj) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">        os &lt;&lt; &quot;Derived: c = &quot; &lt;&lt; obj.c;</span><br><span class="line">        return os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        Base base(1, 2);</span><br><span class="line">        cout &lt;&lt; base &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; &quot;----------------------&quot; &lt;&lt; endl;</span><br><span class="line">    &#123;</span><br><span class="line">        Derived derived(5);</span><br><span class="line">        cout &lt;&lt; derived &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; &quot;Product = &quot; &lt;&lt; derived.product() &lt;&lt; endl; </span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-35-1696518213309104.png" alt="img">运行结果</p>
<h2 id="Access-Control"><a href="#Access-Control" class="headerlink" title="Access Control"></a><strong>Access Control</strong></h2><ul>
<li><p>Public members</p>
<ul>
<li>Accessible anywhere</li>
</ul>
</li>
<li><p>Private members只有类内可以调用</p>
<ul>
<li>Only accessible to the members and friends of that class</li>
</ul>
</li>
<li>Protected members权限位于两者之间，自己的成员，友元以及子类可以调用<ul>
<li>Accessible to the members and friends of that class </li>
<li>Accessible to the members and friends of the derived class</li>
</ul>
</li>
</ul>
<p>不写默认是private</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  private:</span><br><span class="line">    int n; // private member</span><br><span class="line">  public:</span><br><span class="line">    // this-&gt;n is accessible </span><br><span class="line">    Person() : n(10) &#123;&#125;</span><br><span class="line">    // other.n is accessible</span><br><span class="line">    Person(const Person&amp; other) : n(other.n) &#123;&#125;</span><br><span class="line">    // this-&gt;n is accessible</span><br><span class="line">    void set(int n) &#123;this-&gt;n = n;&#125;</span><br><span class="line">    // this-&gt;n and other.n are accessible</span><br><span class="line">    void set(const Person&amp; other) &#123;this-&gt;n = other.n;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-36-1696518213309106.png" alt="img">protected</p>
<p><img src="../img/image-37-1024x365.png" alt="img">protected</p>
<h3 id="Public-Inheritance"><a href="#Public-Inheritance" class="headerlink" title="Public Inheritance"></a>Public Inheritance</h3><ul>
<li>Public members of the base class<ul>
<li>Still be public in the derived class</li>
<li>Accessible anywhere</li>
</ul>
</li>
<li>Protected members of the base class<ul>
<li>Still be protected in the derived class</li>
<li>Accessible in the derived class only</li>
</ul>
</li>
<li>Private members of the base class<ul>
<li>Not accessible in the derived class私有变量可以通过公有函数访问</li>
</ul>
</li>
</ul>
<h3 id="Protected-Inheritance"><a href="#Protected-Inheritance" class="headerlink" title="Protected Inheritance"></a>Protected Inheritance</h3><ul>
<li><p>Public</p>
<p> members and </p>
<p>protected</p>
<p> members of the base class</p>
<ul>
<li>Be <strong>protected</strong> in the derived class</li>
<li>Accessible in the derived class only</li>
</ul>
</li>
<li><p>Private members of the base class</p>
<ul>
<li>Not accessible in the derived class</li>
</ul>
</li>
</ul>
<h3 id="Private-Inheritance"><a href="#Private-Inheritance" class="headerlink" title="Private Inheritance"></a>Private Inheritance</h3><ul>
<li><p>Public</p>
<p> members and </p>
<p>protected</p>
<p> members of the base class</p>
<ul>
<li>Be <strong>private</strong> in the derived class</li>
<li>Accessible in the derived class only</li>
</ul>
</li>
<li><p>Private members of the base class</p>
<ul>
<li>Not accessible in the derived class</li>
</ul>
</li>
</ul>
<h2 id="Virtual-Functions"><a href="#Virtual-Functions" class="headerlink" title="Virtual Functions"></a>Virtual Functions</h2><p><img src="../img/image-38-1024x525.png" alt="img">虚函数</p>
<p>virtual.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    string name;</span><br><span class="line">    Person(string n): name(n)&#123;&#125;</span><br><span class="line">    virtual void print()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Name: &quot; &lt;&lt; name &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Person2</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    string name;</span><br><span class="line">    Person2(string n): name(n)&#123;&#125;</span><br><span class="line">    virtual void print() = 0; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Student: public Person</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">    string id;</span><br><span class="line">    Student(string n, string i): Person(n), id(i)&#123;&#125;</span><br><span class="line">    void print() </span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Name: &quot; &lt;&lt; name;</span><br><span class="line">        cout &lt;&lt; &quot;. ID: &quot; &lt;&lt; id &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void printObjectInfo(Person &amp; p)</span><br><span class="line">&#123;</span><br><span class="line">    p.print();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    &#123;</span><br><span class="line">        Student stu(&quot;yu&quot;, &quot;2019&quot;);</span><br><span class="line">        printObjectInfo(stu);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        Person * p = new Student(&quot;xue&quot;, &quot;2020&quot;);</span><br><span class="line">        p-&gt;print(); //if print() is not a virtual function, different output</span><br><span class="line">        delete p; //if its destructor is not virtual</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // &#123; //if you want to call a function in the base class</span><br><span class="line">    //     Student stu(&quot;li&quot;, &quot;2021&quot;);</span><br><span class="line">    //     stu.Person::print();</span><br><span class="line"></span><br><span class="line">    //     Person * p = new Student(&quot;xue&quot;, &quot;2020&quot;);</span><br><span class="line">    //     p-&gt;Person::print(); </span><br><span class="line">    //     delete p; </span><br><span class="line">    // &#125;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-39-16965182132971.png" alt="img">结果</p>
<p>如果不使用virtual function，调用子类函数将会调用父类对象的函数。</p>
<p>关键词：<code>virtual</code></p>
<p>•But if we define print() function as a virtual function, the output will be different.</p>
<p>•<strong>Static</strong> binding: the compiler decides which function to call</p>
<p>•<strong>Dynamic</strong> binding: the called function is decided at runtime.</p>
<p>•</p>
<p>•Keyword virtual makes the function virtual for the base and all derived classes.</p>
<p>虚函数的绑定不同。一般函数是静态绑定，virtual function是动态绑定，运行时传入的参数进行确定。</p>
<p>子类也会自动变成虚函数。</p>
<p>纯虚函数则没有定义，这个类不能创建对象。<code>virtual void print() = 0;</code></p>
<h3 id="Virtual-Destructors"><a href="#Virtual-Destructors" class="headerlink" title="Virtual Destructors"></a>Virtual Destructors</h3><p>析构函数一定是虚函数。</p>
<h2 id="Inheritance-and-Dynamic-Memory-Allocation"><a href="#Inheritance-and-Dynamic-Memory-Allocation" class="headerlink" title="Inheritance and Dynamic Memory Allocation"></a>Inheritance and Dynamic Memory Allocation</h2><p><img src="../img/image-40-1024x554.png" alt="img">question</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class MyMap: pubic MyString</span><br><span class="line">&#123;</span><br><span class="line">    char * keyname;</span><br><span class="line">  public:</span><br><span class="line">    MyMap(const char * key, const char * value)</span><br><span class="line">    &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">    MyMap(const MyMap &amp; mm): MyString(mm.buf_len, mm.characters)</span><br><span class="line">    &#123;</span><br><span class="line">    //allocate memory for keyname</span><br><span class="line">    //and hard copy from mm to *this</span><br><span class="line">    &#125;</span><br><span class="line">    MyMap &amp; operator=(const MyMap &amp;mm)</span><br><span class="line">    &#123;</span><br><span class="line">       MyString::operator=(mm);</span><br><span class="line">       //allocate memory for keyname</span><br><span class="line">       //and hard copy from mm to *this</span><br><span class="line">       return *this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="Week13"><a href="#Week13" class="headerlink" title="Week13"></a>Week13</h1><h2 id="Class-Templates"><a href="#Class-Templates" class="headerlink" title="Class Templates"></a>Class Templates</h2><h3 id="Review-Function-Templates"><a href="#Review-Function-Templates" class="headerlink" title="Review: Function Templates"></a>Review: Function Templates</h3><p>•A function template is not a type, or a function, or any other entity. </p>
<p>•No code is generated from a source file that contains only template definitions.</p>
<p>•The template arguments must be determined, then the compiler can generate an actual function</p>
<p>•”<strong>Function templates</strong>“ vs “<strong>template functions</strong>“.</p>
<ul>
<li>函数模板：只是模板的空壳子，不是具体的函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T&gt;</span><br><span class="line">T sum(T x, T y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;The input type is &quot; &lt;&lt; typeid(T).name() &lt;&lt; endl;</span><br><span class="line">    return x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>模板函数：函数被实例化后生成的代码</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// instantiates sum&lt;double&gt;(double, double)</span><br><span class="line">template double sum&lt;double&gt;(double, double);</span><br><span class="line">// instantiates sum&lt;char&gt;(char, char), template argument deduced</span><br><span class="line">template char sum&lt;&gt;(char, char); </span><br><span class="line">// instantiates sum&lt;int&gt;(int, int), template argument deduced</span><br><span class="line">template int sum(int, int); </span><br></pre></td></tr></table></figure>
<p>隐式实例化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T&gt;</span><br><span class="line">T product(T x, T y)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; &quot;The input type is &quot; &lt;&lt; typeid(T).name() &lt;&lt; endl;</span><br><span class="line">    return x * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Implicitly instantiates product&lt;int&gt;(int, int)</span><br><span class="line">cout &lt;&lt; &quot;product = &quot; &lt;&lt; product&lt;int&gt;(2.2f, 3.0f) &lt;&lt; endl;</span><br><span class="line">// Implicitly instantiates product&lt;float&gt;(float, float)</span><br><span class="line">cout &lt;&lt; &quot;product = &quot; &lt;&lt; product(2.2f, 3.0f) &lt;&lt; endl;</span><br></pre></td></tr></table></figure>
<h3 id="Different-Classes-for-Different-Type-Matrices"><a href="#Different-Classes-for-Different-Type-Matrices" class="headerlink" title="Different Classes for Different Type Matrices"></a>Different Classes for Different Type Matrices</h3><p><img src="../img/image-41-1024x459.png" alt="img">类模板</p>
<p>matclass.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">// Class IntMat</span><br><span class="line">class IntMat</span><br><span class="line">&#123;</span><br><span class="line">    size_t rows;</span><br><span class="line">    size_t cols;</span><br><span class="line">    int * data;</span><br><span class="line">  public:</span><br><span class="line">    IntMat(size_t rows, size_t cols): </span><br><span class="line">                    rows(rows), cols(cols)</span><br><span class="line">    &#123;</span><br><span class="line">        data = new int[rows * cols * sizeof(int)]&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    ~IntMat()</span><br><span class="line">    &#123;</span><br><span class="line">        delete [] data;</span><br><span class="line">    &#125;</span><br><span class="line">    IntMat(const IntMat&amp;) = delete;</span><br><span class="line">    IntMat&amp; operator=(const IntMat&amp;) = delete;</span><br><span class="line">    int getElement(size_t r, size_t c);</span><br><span class="line">    bool setElement(size_t r, size_t c, int value);</span><br><span class="line">&#125;;</span><br><span class="line">int IntMat::getElement(size_t r, size_t c)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= this-&gt;rows || c &gt;= this-&gt;cols)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;Indices are out of range&quot; &lt;&lt; endl;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    return data[ this-&gt;cols * r + c];</span><br><span class="line">&#125;</span><br><span class="line">bool IntMat::setElement(size_t r, size_t c, int value)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= this-&gt;rows || c &gt;= this-&gt;cols)</span><br><span class="line">        return false;</span><br><span class="line"></span><br><span class="line">    data[ this-&gt;cols * r + c] = value;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Class FloatMat</span><br><span class="line">class FloatMat</span><br><span class="line">&#123;</span><br><span class="line">    size_t rows;</span><br><span class="line">    size_t cols;</span><br><span class="line">    float * data;</span><br><span class="line">  public:</span><br><span class="line">    FloatMat(size_t rows, size_t cols): </span><br><span class="line">                    rows(rows), cols(cols)</span><br><span class="line">    &#123;</span><br><span class="line">        data = new float[rows * cols * sizeof(float)]&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    ~FloatMat()</span><br><span class="line">    &#123;</span><br><span class="line">        delete [] data;</span><br><span class="line">    &#125;</span><br><span class="line">    FloatMat(const FloatMat&amp;) = delete;</span><br><span class="line">    FloatMat&amp; operator=(const FloatMat&amp;) = delete;</span><br><span class="line">    float getElement(size_t r, size_t c);</span><br><span class="line">    bool setElement(size_t r, size_t c, float value);</span><br><span class="line">&#125;;</span><br><span class="line">float FloatMat::getElement(size_t r, size_t c)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= this-&gt;rows || c &gt;= this-&gt;cols)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;getElement(): Indices are out of range&quot; &lt;&lt; endl;</span><br><span class="line">        return 0.f;</span><br><span class="line">    &#125;</span><br><span class="line">    return data[ this-&gt;cols * r + c];</span><br><span class="line">&#125;</span><br><span class="line">bool FloatMat::setElement(size_t r, size_t c, float value)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= this-&gt;rows || c &gt;= this-&gt;cols)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;setElement(): Indices are out of range&quot; &lt;&lt; endl;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    data[ this-&gt;cols * r + c] = value;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    IntMat imat(3,4);</span><br><span class="line">    imat.setElement(1, 2, 256);</span><br><span class="line">    FloatMat fmat(2,3);</span><br><span class="line">    fmat.setElement(1, 2, 3.14159f);</span><br><span class="line"></span><br><span class="line">    // FloatMat fmat2(fmat); //error</span><br><span class="line"></span><br><span class="line">    // FloatMat fmat3(2,3); </span><br><span class="line">    // fmat3 = fmat; //error</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; imat.getElement(1,2) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; fmat.getElement(1,2) &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中的<code>= delete</code>,实现删除默认函数，表示 <strong>防止某个函数被调用</strong>。更进一步来说，可能是为了：<br>（1）防止隐式转换<br>（2）希望类不能被拷贝[ref]<a target="_blank" rel="noopener" href="https://blog.csdn.net/lqw198421/article/details/112906443">C++ =delete的使用_lqw198421的博客-CSDN博客</a>[/ref]</p>
<h3 id="Class-Templates-1"><a href="#Class-Templates-1" class="headerlink" title="Class Templates"></a>Class Templates</h3><p>•A class template defines a family of classes.</p>
<p>•Class template instantiation.</p>
<p>类模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T&gt;</span><br><span class="line">class Mat</span><br><span class="line">&#123;</span><br><span class="line">    size_t rows;</span><br><span class="line">    size_t cols;</span><br><span class="line">    T * data;</span><br><span class="line">  public:</span><br><span class="line">    Mat(size_t rows, size_t cols): rows(rows), cols(cols)</span><br><span class="line">    &#123;</span><br><span class="line">        data = new T[rows * cols * sizeof(T)]&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Mat()</span><br><span class="line">    &#123;</span><br><span class="line">        delete [] data;</span><br><span class="line">    &#125;</span><br><span class="line">    T getElement(size_t r, size_t c);</span><br><span class="line">    bool setElement(size_t r, size_t c, T value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>实例化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// Explicitly instantiate </span><br><span class="line">template class Mat&lt;int&gt;; </span><br></pre></td></tr></table></figure>
<p>mattemplate.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">// Class Template</span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">class Mat</span><br><span class="line">&#123;</span><br><span class="line">    size_t rows;</span><br><span class="line">    size_t cols;</span><br><span class="line">    T * data;</span><br><span class="line">  public:</span><br><span class="line">    Mat(size_t rows, size_t cols): rows(rows), cols(cols)</span><br><span class="line">    &#123;</span><br><span class="line">        data = new T[rows * cols * sizeof(T)]&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Mat()</span><br><span class="line">    &#123;</span><br><span class="line">        delete [] data;</span><br><span class="line">    &#125;</span><br><span class="line">    Mat(const Mat&amp;) = delete;</span><br><span class="line">    Mat&amp; operator=(const Mat&amp;) = delete;</span><br><span class="line">    T getElement(size_t r, size_t c);</span><br><span class="line">    bool setElement(size_t r, size_t c, T value);</span><br><span class="line">&#125;;</span><br><span class="line">template &lt;typename T&gt;</span><br><span class="line">T Mat&lt;T&gt;::getElement(size_t r, size_t c)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= this-&gt;rows || c &gt;= this-&gt;cols)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;getElement(): Indices are out of range&quot; &lt;&lt; endl;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    return data[ this-&gt;cols * r + c];</span><br><span class="line">&#125;</span><br><span class="line">template &lt;typename T&gt;</span><br><span class="line">bool Mat&lt;T&gt;::setElement(size_t r, size_t c, T value)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= this-&gt;rows || c &gt;= this-&gt;cols)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;setElement(): Indices are out of range&quot; &lt;&lt; endl;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data[ this-&gt;cols * r + c] = value;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template class Mat&lt;int&gt;; // Explicitly instantiate template Mat&lt;int&gt;</span><br><span class="line">//template Mat&lt;float&gt; and Mat&lt;double&gt; will be instantiate implicitly</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Mat&lt;int&gt; imat(3,4);</span><br><span class="line">    imat.setElement(1, 2, 256);</span><br><span class="line">    Mat&lt;float&gt; fmat(2,3);</span><br><span class="line">    fmat.setElement(1, 2, 3.14159f);</span><br><span class="line">    Mat&lt;double&gt; dmat(2,3);</span><br><span class="line">    dmat.setElement(1, 2, 2.718281828);</span><br><span class="line"></span><br><span class="line">    // Mat&lt;float&gt; fmat2(fmat); //error</span><br><span class="line"></span><br><span class="line">    // Mat&lt;float&gt; fmat3(2,3);</span><br><span class="line">    // fmat3 = fmat; //error</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; imat.getElement(1,2) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; fmat.getElement(1,2) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; dmat.getElement(1,2) &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也会隐式实例化。</p>
<h2 id="Template-Non-Type-Parameters"><a href="#Template-Non-Type-Parameters" class="headerlink" title="Template Non-Type Parameters"></a>Template Non-Type Parameters</h2><p>非类型参数</p>
<p><img src="../img/image-42-1024x533.png" alt="img">非类型参数</p>
<p>即不是某种类型（如int等），而是一个值（如16）。</p>
<p>•If we want to create a static matrix (no dynamic memory allocation inside)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T, size_t rows, size_t cols&gt;</span><br><span class="line">class Mat</span><br><span class="line">&#123;</span><br><span class="line">    T data[rows][cols];</span><br><span class="line">  public:</span><br><span class="line">    Mat()&#123;&#125;</span><br><span class="line">    T getElement(size_t r, size_t c);</span><br><span class="line">    bool setElement(size_t r, size_t c, T value);</span><br><span class="line">&#125;;</span><br><span class="line">Mat&lt;int&gt; vec1(3, 3);</span><br><span class="line">Mat&lt;int, 3, 3&gt; vec2;</span><br></pre></td></tr></table></figure>
<p>在编译时就把col和row确定了。</p>
<p>nontypeparam.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">// Class Template</span><br><span class="line">template&lt;typename T, size_t rows, size_t cols&gt;</span><br><span class="line">class Mat</span><br><span class="line">&#123;</span><br><span class="line">    T data[rows][cols];</span><br><span class="line">  public:</span><br><span class="line">    Mat()&#123;&#125;</span><br><span class="line">    //// the default copy constructor will copy each element of a static array member</span><br><span class="line">    //// so we do not &#x27;delete&#x27; the copy constructor</span><br><span class="line">    //// the same with the assignment operator</span><br><span class="line">    // Mat(const Mat&amp;) = delete;</span><br><span class="line">    // Mat&amp; operator=(const Mat&amp;) = delete;</span><br><span class="line">    T getElement(size_t r, size_t c);</span><br><span class="line">    bool setElement(size_t r, size_t c, T value);</span><br><span class="line">&#125;;</span><br><span class="line">template&lt;typename T, size_t rows, size_t cols&gt;</span><br><span class="line">T Mat&lt;T, rows, cols&gt;::getElement(size_t r, size_t c)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= rows || c &gt;= cols)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;getElement(): indices are out of range&quot; &lt;&lt; endl;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    return data[r][c];</span><br><span class="line">&#125;</span><br><span class="line">template&lt;typename T, size_t rows, size_t cols&gt;</span><br><span class="line">bool Mat&lt;T, rows, cols&gt;::setElement(size_t r, size_t c, T value)</span><br><span class="line">&#123;</span><br><span class="line">    if ( r &gt;= rows || c &gt;= cols)</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; &quot;setElement(): Indices are out of range&quot; &lt;&lt; endl;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data[r][c] = value;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template class Mat&lt;int, 2, 2&gt;; // Explicitly instantiate template Mat&lt;int, 2, 2&gt;</span><br><span class="line">typedef Mat&lt;int, 2, 2&gt; Mat22i;</span><br><span class="line"></span><br><span class="line">//template Mat&lt;float, 3, 1&gt; will be instantiate implicitly</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Mat22i mat;</span><br><span class="line"></span><br><span class="line">    mat.setElement(2, 3, 256);</span><br><span class="line">    cout &lt;&lt; mat.getElement(2, 3) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    mat.setElement(1, 1, 256);</span><br><span class="line">    cout &lt;&lt; mat.getElement(1, 1) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Mat&lt;float, 3, 1&gt; vec;</span><br><span class="line">    vec.setElement(2, 0, 3.14159f);</span><br><span class="line">    cout &lt;&lt; vec.getElement(2, 0) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    Mat&lt;float, 3, 1&gt; vec2(vec);</span><br><span class="line">    cout &lt;&lt; vec2.getElement(2, 0) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    // vec2 = mat; //error</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>对象赋值操作，内部的静态数组会直接进行拷贝</strong>。</p>
<h2 id="Class-Template-Specialization"><a href="#Class-Template-Specialization" class="headerlink" title="Class Template Specialization"></a>Class Template Specialization</h2><p>•The class template can be for most types</p>
<p>•But we want to save memory for type bool (1 byte or 1 bit).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T&gt;</span><br><span class="line">class MyVector</span><br><span class="line">&#123;</span><br><span class="line">    size_t length;</span><br><span class="line">    T * data;</span><br><span class="line">  public:</span><br><span class="line">    MyVector(size_t length): length(length)</span><br><span class="line">    &#123; data = new T[length * sizeof(T)]&#123;&#125;; &#125;</span><br><span class="line">    ~MyVector()</span><br><span class="line">    &#123; delete [] data; &#125;</span><br><span class="line">    MyVector(const MyVector&amp;) = delete;</span><br><span class="line">    MyVector&amp; operator=(const MyVector&amp;) = delete;</span><br><span class="line">    T getElement(size_t index);</span><br><span class="line">    bool setElement(size_t index, T value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>•Specialize MyVector for bool</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">template&lt;&gt;</span><br><span class="line">class MyVector&lt;bool&gt;</span><br><span class="line">&#123;</span><br><span class="line">    size_t length;</span><br><span class="line">    unsigned char * data;</span><br><span class="line">  public:</span><br><span class="line">    MyVector(size_t length): length(length)</span><br><span class="line">    &#123;</span><br><span class="line">        int num_bytes = (length - 1) / 8 + 1;</span><br><span class="line">        data = new unsigned char[num_bytes]&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    ~MyVector()</span><br><span class="line">    &#123;</span><br><span class="line">        delete [] data;</span><br><span class="line">    &#125;</span><br><span class="line">    MyVector(const MyVector&amp;) = delete;</span><br><span class="line">    MyVector&amp; operator=(const MyVector&amp;) = delete;</span><br><span class="line">    bool getElement(size_t index);</span><br><span class="line">    bool setElement(size_t index, bool value);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="std-classes"><a href="#std-classes" class="headerlink" title="std classes"></a>std classes</h2><h3 id="std-basic-string"><a href="#std-basic-string" class="headerlink" title="std::basic_string"></a>std::basic_string</h3><p>•Store and manipulate sequences of char-like objects.</p>
<p><img src="../img/image-43-1024x554.png" alt="img">string</p>
<h3 id="std-array"><a href="#std-array" class="headerlink" title="std::array"></a>std::array</h3><p>•a container that encapsulates fixed size arrays.</p>
<p><img src="../img/image-44-1024x397.png" alt="img">array</p>
<h3 id="Some-other-templates"><a href="#Some-other-templates" class="headerlink" title="Some other templates"></a>Some other templates</h3><p><img src="../img/image-45-1024x456.png" alt="img">other</p>
<h1 id="Week14"><a href="#Week14" class="headerlink" title="Week14"></a>Week14</h1><h2 id="Standard-Output-Stream-and-Standard-Error-Stream"><a href="#Standard-Output-Stream-and-Standard-Error-Stream" class="headerlink" title="Standard Output Stream and Standard Error Stream"></a>Standard Output Stream and Standard Error Stream</h2><h3 id="stdin-stdout-stderr"><a href="#stdin-stdout-stderr" class="headerlink" title="stdin, stdout, stderr"></a>stdin, stdout, stderr</h3><p>•In C, three text streams are predefined, and their type is (FILE *).</p>
<p>•stdin: standard input stream</p>
<p>•stdout: standard output stream, for conventional output</p>
<p>•stderr: standard error stream, for diagnostic output.</p>
<p>•Why do we need the “ugly” black command windows?</p>
<h3 id="Output-Stream-and-Error-Stream"><a href="#Output-Stream-and-Error-Stream" class="headerlink" title="Output Stream and Error Stream"></a>Output Stream and Error Stream</h3><p><img src="../img/image-46.png" alt="img">Output Stream and Error Stream</p>
<p>stderr.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">void div2(int n)</span><br><span class="line">&#123;</span><br><span class="line">    if( n % 2 != 0)</span><br><span class="line">    &#123;</span><br><span class="line">        fprintf(stderr, &quot;Error: The input must be an even number. Here it&#x27;s %d\n&quot;, n);</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        int result = n / 2;</span><br><span class="line">        fprintf(stdout, &quot;Info: The result is %d\n&quot;, result);</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    for(int n = -5; n &lt;= 5; n++)</span><br><span class="line">        div2(n);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-47-1696518213310118.png" alt="img">c版本错误</p>
<p>stderr.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">void div2(int n)</span><br><span class="line">&#123;</span><br><span class="line">    if( n % 2 != 0)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;Error: The input must be an even number. Here it&#x27;s &quot; &lt;&lt; n &lt;&lt; &quot;.&quot; &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        int result = n / 2;</span><br><span class="line">        std::cout &lt;&lt; &quot;Info: The result is &quot; &lt;&lt; result &lt;&lt; &quot;.&quot; &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    for(int n = -5; n &lt;= 5; n++)</span><br><span class="line">        div2(n);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-48-1696518213310120.png" alt="img">cpp版本错误</p>
<h3 id="Redirection"><a href="#Redirection" class="headerlink" title="Redirection"></a>Redirection</h3><p>•The output of a program is in a pipeline.</p>
<p>•The output can be redirected. You can redirect the output into a file for debugging especially when the program run a very long time.</p>
<p>前面程序的输出作为后面程序的输入。</p>
<p><img src="../img/image-49-1024x433.png" alt="img">管道</p>
<p>使用<code>./a.out | less</code>查看</p>
<p><img src="../img/image-50-16965182132982.png" alt="img">显示标准输出内容</p>
<p>含义：</p>
<ul>
<li><code>&gt;</code>表示销毁并重新创建文件，将标准输出流内容写入</li>
<li><code>1&gt;</code>含义同&gt;</li>
<li><code>&gt;&gt;</code>表示如果不存在则创建，否则将内容加在已有内容后面</li>
<li><code>&gt; /dev/null</code> 则是将其销毁</li>
<li><code>2&gt;</code> 处理标准错误流</li>
<li><code>&amp;&gt;</code> 输出所有</li>
<li><code>&gt; abc.log 2&gt;&amp;1</code> 等效于 <code>&gt;&amp; abc.log</code> 等效于 <code>&amp;&gt; abc.log</code>[ref]<a target="_blank" rel="noopener" href="https://blog.csdn.net/HD243608836/article/details/121429020">Linux shell中2＞&amp;1输出日志文件内容的含义解释 （全网最全，看完就懂）_linux 输出log_HD243608836的博客-CSDN博客</a>[/ref]</li>
<li><code>2&gt;&gt;</code>实现错误流追加</li>
</ul>
<p><img src="../img/image-51.png" alt="img">只有错误流输出，标准流被重定向到t.txt</p>
<p><img src="../img/image-53-16965182132983.png" alt="img">t.txt内容</p>
<h2 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h2><p>•assert is a function-like macro in <assert.h> and <cassert>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifdef NDEBUG</span><br><span class="line"># define assert(condition) ((void)0)</span><br><span class="line">#else</span><br><span class="line"># define assert(condition) /*implementation defined*/</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>Do nothing if the condition is true</p>
<p>Output diagnostic information and call abort() if the condition is false.</p>
<p>•If NDEBUG is defined, do nothing whatever the condition is.</p>
<p>•assert can be used only for debugging, be removed by a macro NDEBUG before releasing.</p>
<p>assert.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cassert&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char ** argv)</span><br><span class="line">&#123;</span><br><span class="line">    assert( argc == 2);</span><br><span class="line">    std::cout &lt;&lt; &quot;This is an assert example.&quot; &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-54-1696518213310126.png" alt="img">断言</p>
<p>在第二行加入宏定义<code>#define **NDEBUG**</code>，则断言取消。</p>
<p>或者也可以通过编译时或在cmake时定义。<code>g++ assert.cpp -DNDEBUG</code></p>
<h2 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h2><p>•Solution 1: Kill the program when error occurs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">float ratio(float a, float b)</span><br><span class="line">&#123;</span><br><span class="line">    if (fabs(a + b) &lt; FLT_EPSILON)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;Error ...&quot; &lt;&lt; std::endl;</span><br><span class="line">        std::abort();</span><br><span class="line">    &#125;</span><br><span class="line">    return (a - b) / (a + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>•Solution 2: Tell the caller by the return value when error occurs</p>
<p>•We have to use the 3rd parameter to send the result.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bool ratio(float a, float b, float &amp; c)</span><br><span class="line">&#123;</span><br><span class="line">    if (fabs(a + b) &lt; FLT_EPSILON)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cerr &lt;&lt; &quot;Error ...&quot; &lt;&lt; std::endl;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    c = (a - b) / (a + b);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>•Solution 3: Throw exceptions (C++ feature)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">float ratio(float a, float b)</span><br><span class="line">&#123;</span><br><span class="line">    if (fabs(a + b) &lt; FLT_EPSILON)</span><br><span class="line">        throw &quot;Error ...&quot;;</span><br><span class="line">    return (a - b) / (a + b);</span><br><span class="line">&#125;</span><br><span class="line">try&#123;</span><br><span class="line">    z = ratio(x,y);</span><br><span class="line">    std::cout &lt;&lt; z &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">catch(const char * msg)</span><br><span class="line">&#123;</span><br><span class="line">    std::cerr &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>error3.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstdlib&gt;</span><br><span class="line">#include &lt;cfloat&gt;</span><br><span class="line">#include &lt;cmath&gt;</span><br><span class="line"></span><br><span class="line">float ratio(float a, float b)</span><br><span class="line">&#123;</span><br><span class="line">    if (fabs(a + b) &lt; FLT_EPSILON)</span><br><span class="line">        throw &quot;The sum of the two arguments is close to zero.&quot;;</span><br><span class="line"></span><br><span class="line">    return (a - b) / (a + b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    float x = 0.f;</span><br><span class="line">    float y = 0.f;</span><br><span class="line">    float z = 0.f;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; &quot;Please input two numbers &lt;q to quit&gt;:&quot;;</span><br><span class="line">    while (std::cin &gt;&gt; x &gt;&gt; y)</span><br><span class="line">    &#123;</span><br><span class="line">        &#123; //try and catch</span><br><span class="line">            try&#123;</span><br><span class="line">                z = ratio(x,y);</span><br><span class="line">                std::cout &lt;&lt; &quot;ratio(&quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y&lt;&lt; &quot;) = &quot; &lt;&lt; z &lt;&lt; std::endl;</span><br><span class="line">            &#125;</span><br><span class="line">            catch(const char * msg)</span><br><span class="line">            &#123;</span><br><span class="line">                std::cerr &lt;&lt; &quot;Call ratio() failed: &quot; &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">                std::cerr &lt;&lt; &quot;I give you another chance.&quot; &lt;&lt; std::endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // &#123; //if no try-catch</span><br><span class="line">        //     z = ratio(x,y);</span><br><span class="line">        //     std::cout &lt;&lt; &quot;ratio(&quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y&lt;&lt; &quot;) = &quot; &lt;&lt; z &lt;&lt; std::endl;            </span><br><span class="line">        // &#125;</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; &quot;Please input two numbers &lt;q to quit&gt;:&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; &quot;Bye!&quot; &lt;&lt; std::endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-55-16965182132994.png" alt="img">运行结果</p>
<h2 id="More-About-Exceptions"><a href="#More-About-Exceptions" class="headerlink" title="More About Exceptions"></a>More About Exceptions</h2><p><img src="../img/image-56-1024x485.png" alt="img">A try block can be followed by multiple catch blocks.</p>
<h3 id="Stack-Unwinding"><a href="#Stack-Unwinding" class="headerlink" title="Stack Unwinding"></a>Stack Unwinding</h3><p>•If an exception is not handled in the function, throw it to the caller.</p>
<p>•If the caller does not handle, throw it to the caller of the caller, or until main()</p>
<p>异常如果没被处理，则会继续往外抛</p>
<p><img src="../img/image-57-1024x478.png" alt="img">Stack Unwinding</p>
<h3 id="std-exception"><a href="#std-exception" class="headerlink" title="std::exception"></a>std::exception</h3><p>•std::exception is a class that can be a base class for any exception.</p>
<p>•Function std:exception::what() can be overridden to return a C-style string message.</p>
<p><img src="../img/image-58-1024x448.png" alt="img">std::exception</p>
<h3 id="Exception-Specifications-and-noexcept"><a href="#Exception-Specifications-and-noexcept" class="headerlink" title="Exception Specifications and noexcept"></a><strong>Exception Specifications and noexcept</strong></h3><p>•The noexcept specifier defines a function which will not throw anything.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void foo() noexcept; // this function is non-throwing</span><br></pre></td></tr></table></figure>
<h3 id="nothrow-new"><a href="#nothrow-new" class="headerlink" title="nothrow new"></a>nothrow new</h3><p>•std::nothrow is a constant to select a non-throwing allocation function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int * p = NULL;</span><br><span class="line"></span><br><span class="line">try &#123;// may throw an exception</span><br><span class="line">    p = new int[length];</span><br><span class="line">&#125;</span><br><span class="line">catch (std::bad_alloc &amp; ba)</span><br><span class="line">&#123;</span><br><span class="line">    cerr &lt;&lt; ba.what() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// not throw an exception</span><br><span class="line">p = new(nothrow) int[length];</span><br><span class="line">if(p==NULL)</span><br><span class="line">&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>new 失败会抛异常。</p>
<p>nothrow.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;cstdlib&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    size_t length = 80000000000L;</span><br><span class="line">    int * p = NULL;</span><br><span class="line">    </span><br><span class="line">    try &#123;</span><br><span class="line">        cout &lt;&lt; &quot;Trying to allocate a big block of memory&quot; &lt;&lt; endl;</span><br><span class="line">        p = new int[length];</span><br><span class="line">        //p = new(nothrow) int[length];</span><br><span class="line">        cout &lt;&lt; &quot;No exception.&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (std::bad_alloc &amp; ba)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;bad_alloc exception!&quot; &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; ba.what() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if(p)</span><br><span class="line">        cout &lt;&lt; &quot;Memory successfully allocated.&quot; &lt;&lt; endl;</span><br><span class="line">    else</span><br><span class="line">        cout &lt;&lt; &quot;So bad, null pointer.&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    // for(size_t i = 0; i &lt; length; i++)</span><br><span class="line">    //     p[i] = i;</span><br><span class="line">    // size_t sum;</span><br><span class="line">    // for(size_t i = 0; i &lt; length; i++)</span><br><span class="line">    //     sum += p[i];</span><br><span class="line">    // cout &lt;&lt; &quot;Sum = &quot; &lt;&lt; sum &lt;&lt; endl;</span><br><span class="line">    if(p)</span><br><span class="line">        delete [] p;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>申请超过范围大小的内存。</p>
<p><img src="../img/image-59-16965182132995.png" alt="img">报错</p>
<p>苹果等可能不会报错。</p>
<h1 id="Week15"><a href="#Week15" class="headerlink" title="Week15"></a>Week15</h1><h2 id="Friend-Classes"><a href="#Friend-Classes" class="headerlink" title="Friend Classes"></a>Friend Classes</h2><h3 id="friend-Functions"><a href="#friend-Functions" class="headerlink" title="friend Functions"></a>friend Functions</h3><p>•A friend function is defined out of the class.</p>
<p>•No MyTime:: before its function name</p>
<p>注意：<strong>友元函数不是成员函数</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class MyTime</span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  public:</span><br><span class="line">    friend MyTime operator+(int m, const MyTime &amp; t);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyTime operator+(int m, const MyTime &amp; t)</span><br><span class="line">&#123;</span><br><span class="line">    return t + m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="friend-Classes"><a href="#friend-Classes" class="headerlink" title="friend Classes"></a>friend Classes</h3><p>•A class is a friend of another class.</p>
<p>•The friend class can access all members even private members.</p>
<p>•A friend class can be public, protected and private.</p>
<p><img src="../img/image-61-980x1024.png" alt="img">友元类</p>
<p>设置友元类，该友元类可以获得自己的私有成员。</p>
<p>friend.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Sniper</span><br><span class="line">&#123;</span><br><span class="line">private:</span><br><span class="line">    int bullets;</span><br><span class="line">public:</span><br><span class="line">    Sniper(int bullets = 0): bullets(bullets)&#123;&#125;</span><br><span class="line">    friend class Supplier;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Supplier</span><br><span class="line">&#123;</span><br><span class="line">    int storage;</span><br><span class="line">public:</span><br><span class="line">    Supplier(int storage = 1000): storage(storage)&#123;&#125;</span><br><span class="line">    bool provide(Sniper &amp; sniper)</span><br><span class="line">    &#123;</span><br><span class="line">        // bullets is a private member</span><br><span class="line">        if (sniper.bullets &lt; 20) //no enough bullets</span><br><span class="line">        &#123;</span><br><span class="line">            if (this-&gt;storage &gt; 100 )</span><br><span class="line">            &#123;</span><br><span class="line">                sniper.bullets += 100;</span><br><span class="line">                this-&gt;storage -= 100;</span><br><span class="line">            &#125;</span><br><span class="line">            else if(this-&gt;storage &gt; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                sniper.bullets += this-&gt;storage;</span><br><span class="line">                this-&gt;storage = 0;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">                return false;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; &quot;sniper has &quot; &lt;&lt; sniper.bullets &lt;&lt; &quot; bullets now.&quot; &lt;&lt; endl;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Sniper sniper(2);</span><br><span class="line">    Supplier supplier(2000);</span><br><span class="line">    supplier.provide(sniper);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="friend-Member-Functions"><a href="#friend-Member-Functions" class="headerlink" title="friend Member Functions"></a>friend <strong>Member</strong> Functions</h3><p>•A single member function of a class is a friend.</p>
<p>•Different from friend functions.</p>
<p>•But very similar to a normal friend function.</p>
<p>•But… declaration problem …</p>
<p><img src="../img/image-62-1024x371.png" alt="img">友元成员函数</p>
<p>最小授权，很容易引起死锁，要将函数实现放在最外面。</p>
<h2 id="Nested-Types"><a href="#Nested-Types" class="headerlink" title="Nested Types"></a>Nested Types</h2><p>嵌套类型</p>
<h3 id="Nested-Enumerations-C-11"><a href="#Nested-Enumerations-C-11" class="headerlink" title="Nested Enumerations (C++11)"></a>Nested Enumerations (C++11)</h3><p>•enum DataType is only used in class Mat, we can put it inside of Mat.</p>
<p><img src="../img/image-63-1024x665.png" alt="img">Nested Enumerations</p>
<p><img src="../img/image-64-1024x521.png" alt="img">放到内部</p>
<h3 id="Nested-Classes"><a href="#Nested-Classes" class="headerlink" title="Nested Classes"></a>Nested Classes</h3><p>•Nested classes: The declaration of a class/struct or union may appear inside another class.</p>
<p><img src="../img/image-65-1024x676.png" alt="img">内部类</p>
<h3 id="Nested-Types-Scope"><a href="#Nested-Types-Scope" class="headerlink" title="Nested Types: Scope"></a>Nested Types: Scope</h3><p><strong>Private:</strong> </p>
<p>•Only visible to the containing class</p>
<p><strong>Protected:</strong></p>
<p>•Visible to the containing class and its derived class.</p>
<p><strong>Public:</strong></p>
<p>•Visible to the containing class, to its derived classes, and to the outside world.</p>
<h2 id="RTTI-and-Type-Cast-Operators"><a href="#RTTI-and-Type-Cast-Operators" class="headerlink" title="RTTI and Type Cast Operators"></a>RTTI and Type Cast Operators</h2><p>RTTI：运行时类型鉴别</p>
<p>•Runtime type identification (RTTI)</p>
<p> C++ feature</p>
<p> The type of an object to be determined during runtime.</p>
<p>•<code>dynamic_cast</code> operator: conversion of polymorphic types.</p>
<p>•<code>typeid</code> operator: Identify the exact type of an object.</p>
<p>•<code>type_info</code> class. the type information returned by the <code>typeid</code> operator.</p>
<h3 id="typeid"><a href="#typeid" class="headerlink" title="typeid"></a>typeid</h3><p><img src="../img/image-66-1024x295.png" alt="img">typeid</p>
<p>typeid.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;typeinfo&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">protected:</span><br><span class="line">    string name;</span><br><span class="line">public:</span><br><span class="line">    Person(string name=&quot;&quot;):name(name)&#123;&#125;;</span><br><span class="line">    virtual ~Person()&#123;&#125;</span><br><span class="line">    string getInfo()&#123;return name;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Student: public Person</span><br><span class="line">&#123;</span><br><span class="line">    string studentid;</span><br><span class="line">public:</span><br><span class="line">    Student(string name=&quot;&quot;, string sid=&quot;&quot;):Person(name),studentid(sid)&#123;&#125;;</span><br><span class="line">    string getInfo()&#123;return name+&quot;:&quot;+studentid;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    string s(&quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;typeid.name of s           is &quot; &lt;&lt; typeid(s).name() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;typeid.name of std::string is &quot; &lt;&lt; typeid(std::string).name() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;typeid.name of Student     is &quot; &lt;&lt; typeid(Student).name() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    if(typeid(std::string) == typeid(s))</span><br><span class="line">        cout &lt;&lt; &quot;s is a std::string object.&quot; &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-67-1024x125.png" alt="img">typeid</p>
<h3 id="dynamic-cast"><a href="#dynamic-cast" class="headerlink" title="dynamic_cast"></a>dynamic_cast</h3><p>•It can safely assign the address of an object to a pointer of a particular type.</p>
<p>•Invoke the correct version of a class method (remember virtual functions)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Person person(&quot;Yu&quot;);</span><br><span class="line">Student student(&quot;Sam&quot;, &quot;20210212&quot;);</span><br><span class="line">Person* pp = NULL;</span><br><span class="line">Student * ps = NULL; </span><br><span class="line">ps = dynamic_cast&lt;Student*&gt;(&amp;person); // NULL</span><br><span class="line">pp = dynamic_cast&lt;Person*&gt;(&amp;student);</span><br></pre></td></tr></table></figure>
<p>rtti.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">protected:</span><br><span class="line">    string name;</span><br><span class="line">public:</span><br><span class="line">    Person(string name=&quot;&quot;):name(name)&#123;&#125;;</span><br><span class="line">    virtual ~Person()&#123;&#125;</span><br><span class="line">    virtual string getInfo()&#123;return name;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Student: public Person</span><br><span class="line">&#123;</span><br><span class="line">    string studentid;</span><br><span class="line">public:</span><br><span class="line">    Student(string name=&quot;&quot;, string sid=&quot;&quot;):Person(name),studentid(sid)&#123;&#125;;</span><br><span class="line">    string getInfo()&#123;return name+&quot;:&quot;+studentid;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    Person person(&quot;Yu&quot;);</span><br><span class="line">    Student student(&quot;Sam&quot;, &quot;20210212&quot;);</span><br><span class="line">    Person* pp = &amp;student;</span><br><span class="line">    Person&amp; rp = student;</span><br><span class="line">    Student * ps = (Student*)&amp;person; // danger!</span><br><span class="line">    cout &lt;&lt; person.getInfo() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; ps-&gt;getInfo() &lt;&lt; endl; // danger if getInfo is not virtual</span><br><span class="line"></span><br><span class="line">    ps = dynamic_cast&lt;Student*&gt;(&amp;person);</span><br><span class="line">    printf(&quot;address = %p\n&quot;, ps);</span><br><span class="line">    pp = dynamic_cast&lt;Person*&gt;(&amp;student);</span><br><span class="line">    printf(&quot;address = %p\n&quot;, pp);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-68-1024x231.png" alt="img">转化失败</p>
<p>父类析构有了virtual才是多态。</p>
<p><em>上</em>行转换（子类转父类）<em>，</em>转换安全，成功返回类对象指针, 此时和static_<em>cast 作用一样。</em></p>
<p>下行转换（父类转子类）， 父类中要有虚函数，否则编译器报错。转换分几种情况：</p>
<p>a. 父类指针指向子类对象，转换安全， dynamic_cast返回类对象指针。</p>
<p>b.父类指针指向父类对象，转换不安全，dynamic_cast 返回nullptr。此时若使用static_cast, 返回非空指针，更不安全。[ref]<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/459523323">C++类型转换之dynamic_cast - 知乎 (zhihu.com)</a>[/ref]</p>
<h3 id="More-Type-Cast-Operators"><a href="#More-Type-Cast-Operators" class="headerlink" title="More Type Cast Operators"></a>More Type Cast Operators</h3><p><img src="../img/image-69-1024x658.png" alt="img">More Type Cast Operators</p>
<p>const_cast.cpp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int value1 = 100;</span><br><span class="line">    const int value2 = 200;</span><br><span class="line">    cout &lt;&lt; &quot;value1 = &quot; &lt;&lt; value1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;value2 = &quot; &lt;&lt; value2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    int * pv1 = const_cast&lt;int *&gt;(&amp;value1);</span><br><span class="line">    int * pv2 = const_cast&lt;int *&gt;(&amp;value2);</span><br><span class="line"></span><br><span class="line">    (*pv1)++;</span><br><span class="line">    (*pv2)++;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;value1 = &quot; &lt;&lt; value1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;value2 = &quot; &lt;&lt; value2 &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    int&amp; v2 = const_cast&lt;int&amp;&gt;(value2);</span><br><span class="line">    v2++;</span><br><span class="line">    cout &lt;&lt; &quot;value2 = &quot; &lt;&lt; value2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; &quot;*pv2 = &quot; &lt;&lt; (*pv2) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; &quot;v2 = &quot; &lt;&lt; v2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">   return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="../img/image-70-16965182133006.png" alt="img">const_cast</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46210273/article/details/121147406">C++ 四种cast 详解<em>c++ cast</em>帅B猪的博客-CSDN博客</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://blog.huii.top">HUII</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.huii.top/Note/12d6d3a0881a.html">https://blog.huii.top/Note/12d6d3a0881a.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.huii.top" target="_blank">HUII's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a><a class="post-meta__tags" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><a class="post-meta__tags" href="/tags/RNN/">RNN</a></div><div class="post_share"><div class="social-share" data-image="/img/1676641492749-1024x640.jpg" data-sites="qq,wechat,weibo,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/MachineLearning/89747e24e95f.html" title="机器学习线性代数基础"><img class="cover" src="/img/machinelearning.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">机器学习线性代数基础</div></div></a></div><div class="next-post pull-right"><a href="/MCU/be8ae3d50499.html" title="ESP32-C3手动烧录bin文件"><img class="cover" src="/img/esp32-c3-banner-small.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ESP32-C3手动烧录bin文件</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/MachineLearning/74e60f4fb549.html" title="RNN循环神经网络"><img class="cover" src="/img/machinelearning.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-17</div><div class="title">RNN循环神经网络</div></div></a></div><div><a href="/MachineLearning/9de011f33507.html" title="Fast R-CNN——RCNN系列算法Ⅱ"><img class="cover" src="/img/machinelearning.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-23</div><div class="title">Fast R-CNN——RCNN系列算法Ⅱ</div></div></a></div><div><a href="/MachineLearning/b91d8b42ccc3.html" title="Faster R-CNN——RCNN系列算法Ⅲ"><img class="cover" src="/img/machinelearning.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-27</div><div class="title">Faster R-CNN——RCNN系列算法Ⅲ</div></div></a></div><div><a href="/MachineLearning/40a2efd7e498.html" title="PyTorch中的一些函数"><img class="cover" src="/img/machinelearning.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-16</div><div class="title">PyTorch中的一些函数</div></div></a></div><div><a href="/MachineLearning/794a5634681d.html" title="R-CNN——RCNN系列算法Ⅰ"><img class="cover" src="/img/machinelearning.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-21</div><div class="title">R-CNN——RCNN系列算法Ⅰ</div></div></a></div><div><a href="/MachineLearning/4543f3866cda.html" title="YOLO v1笔记"><img class="cover" src="/img/machinelearning.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-12</div><div class="title">YOLO v1笔记</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Week1"><span class="toc-number">1.</span> <span class="toc-text">Week1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#the-first-example"><span class="toc-number">1.1.</span> <span class="toc-text">the first example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E9%93%BE%E6%8E%A5"><span class="toc-number">1.2.</span> <span class="toc-text">编译链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86%E5%92%8C%E5%AE%8F"><span class="toc-number">1.3.</span> <span class="toc-text">预处理和宏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA"><span class="toc-number">1.4.</span> <span class="toc-text">输入输出</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week2"><span class="toc-number">2.</span> <span class="toc-text">Week2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#interger"><span class="toc-number">2.1.</span> <span class="toc-text">interger</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#more-interger-types"><span class="toc-number">2.2.</span> <span class="toc-text">more interger types</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#char"><span class="toc-number">2.2.1.</span> <span class="toc-text">char</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bool"><span class="toc-number">2.2.2.</span> <span class="toc-text">bool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fixed-width-integer-types"><span class="toc-number">2.2.3.</span> <span class="toc-text">Fixed width integer types</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Floating-point-Numbers"><span class="toc-number">2.3.</span> <span class="toc-text">Floating-point Numbers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#inf-and-nan"><span class="toc-number">2.3.1.</span> <span class="toc-text">inf and nan</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arithmetic-Operators"><span class="toc-number">2.4.</span> <span class="toc-text">Arithmetic Operators</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#auto"><span class="toc-number">2.4.1.</span> <span class="toc-text">auto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Divisions"><span class="toc-number">2.4.2.</span> <span class="toc-text">Divisions</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week3"><span class="toc-number">3.</span> <span class="toc-text">Week3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#goto-Statement"><span class="toc-number">3.1.</span> <span class="toc-text">goto Statement</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week4"><span class="toc-number">4.</span> <span class="toc-text">Week4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Arrays"><span class="toc-number">4.1.</span> <span class="toc-text">Arrays</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Variable-length-arrays"><span class="toc-number">4.1.1.</span> <span class="toc-text">Variable-length arrays</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arrays-of-unknown-size"><span class="toc-number">4.1.2.</span> <span class="toc-text">Arrays of unknown size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Element-accessing"><span class="toc-number">4.1.3.</span> <span class="toc-text">Element accessing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Multidimensional-arrays"><span class="toc-number">4.1.4.</span> <span class="toc-text">Multidimensional arrays</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-Arrays"><span class="toc-number">4.1.5.</span> <span class="toc-text">const Arrays</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Strings"><span class="toc-number">4.2.</span> <span class="toc-text">Strings</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Array-style-strings"><span class="toc-number">4.2.1.</span> <span class="toc-text">Array-style strings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#String-literals"><span class="toc-number">4.2.2.</span> <span class="toc-text">String literals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string-class"><span class="toc-number">4.2.3.</span> <span class="toc-text">string class</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Structures-Unions-and-Enumerations"><span class="toc-number">4.3.</span> <span class="toc-text">Structures, Unions and Enumerations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#struct"><span class="toc-number">4.3.1.</span> <span class="toc-text">struct</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Structure-padding"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">Structure padding</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#struct-in-C-and-C"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">struct in C and C++</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#union"><span class="toc-number">4.3.2.</span> <span class="toc-text">union</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#enum"><span class="toc-number">4.3.3.</span> <span class="toc-text">enum</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#typedef"><span class="toc-number">4.4.</span> <span class="toc-text">typedef</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week5"><span class="toc-number">5.</span> <span class="toc-text">Week5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pointers"><span class="toc-number">5.1.</span> <span class="toc-text">Pointers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Differences-between-a-pointer-and-an-array"><span class="toc-number">5.1.1.</span> <span class="toc-text">Differences between a pointer and an array</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Allocate-memory-C-style"><span class="toc-number">5.2.</span> <span class="toc-text">Allocate memory: C style</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Memory-allocation"><span class="toc-number">5.2.1.</span> <span class="toc-text">Memory allocation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memory-deallocation"><span class="toc-number">5.2.2.</span> <span class="toc-text">Memory deallocation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Allocate-memory-C-style-1"><span class="toc-number">5.3.</span> <span class="toc-text">Allocate memory: C++ style</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Operator-new-and-new"><span class="toc-number">5.3.1.</span> <span class="toc-text">Operator new and new[]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operator-delete-and-delete"><span class="toc-number">5.3.2.</span> <span class="toc-text">Operator delete and delete[]</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week6"><span class="toc-number">6.</span> <span class="toc-text">Week6</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Functions"><span class="toc-number">6.1.</span> <span class="toc-text">Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#How-are-functions-called"><span class="toc-number">6.1.1.</span> <span class="toc-text">How are functions called?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function-Parameters"><span class="toc-number">6.2.</span> <span class="toc-text">Function Parameters</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Pass-by-value-fundamental-type"><span class="toc-number">6.2.1.</span> <span class="toc-text">Pass by value: fundamental type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pass-by-value-pointer"><span class="toc-number">6.2.2.</span> <span class="toc-text">Pass by value: pointer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Pass-by-value-structure"><span class="toc-number">6.2.3.</span> <span class="toc-text">Pass by value: structure</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">6.3.</span> <span class="toc-text">References</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#References-as-function-parameters"><span class="toc-number">6.3.1.</span> <span class="toc-text">References as function parameters</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inline-functions"><span class="toc-number">6.4.</span> <span class="toc-text">Inline functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-not-use-a-macros"><span class="toc-number">6.4.1.</span> <span class="toc-text">Why not use a macros?</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week7"><span class="toc-number">7.</span> <span class="toc-text">Week7</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Default-Arguments"><span class="toc-number">7.1.</span> <span class="toc-text">Default Arguments</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function-Overloading"><span class="toc-number">7.2.</span> <span class="toc-text">Function Overloading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function-Templates"><span class="toc-number">7.3.</span> <span class="toc-text">Function Templates</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-template-specialization"><span class="toc-number">7.3.1.</span> <span class="toc-text">Function template specialization</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Function-Pointers-and-References"><span class="toc-number">7.4.</span> <span class="toc-text">Function Pointers and References</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-pointers"><span class="toc-number">7.4.1.</span> <span class="toc-text">Function pointers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Function-references"><span class="toc-number">7.4.2.</span> <span class="toc-text">Function references</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recursive-Functions"><span class="toc-number">7.5.</span> <span class="toc-text">Recursive Functions</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week8"><span class="toc-number">8.</span> <span class="toc-text">Week8</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#C-C-with-ARM"><span class="toc-number">8.1.</span> <span class="toc-text">C&#x2F;C++ with ARM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Speedup-Your-Program"><span class="toc-number">8.2.</span> <span class="toc-text">Speedup Your Program</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-Tips-on-Optimization"><span class="toc-number">8.2.1.</span> <span class="toc-text">Some Tips on Optimization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SIMD-Single-instruction-multiple-data"><span class="toc-number">8.2.2.</span> <span class="toc-text">SIMD: Single instruction, multiple data</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#An-Example-with-SIMD-and-OpenMP"><span class="toc-number">8.3.</span> <span class="toc-text">An Example with SIMD and OpenMP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Avoid-Memory-Copy"><span class="toc-number">8.4.</span> <span class="toc-text">Avoid Memory Copy</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week9"><span class="toc-number">9.</span> <span class="toc-text">Week9</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Classes-and-Objects"><span class="toc-number">9.1.</span> <span class="toc-text">Classes and Objects</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Structures"><span class="toc-number">9.1.1.</span> <span class="toc-text">Structures</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Classes"><span class="toc-number">9.1.2.</span> <span class="toc-text">Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Access-Specifiers"><span class="toc-number">9.1.3.</span> <span class="toc-text">Access Specifiers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Member-Functions"><span class="toc-number">9.1.4.</span> <span class="toc-text">Member Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#File-Structures"><span class="toc-number">9.1.5.</span> <span class="toc-text">File Structures</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Constructors-and-Destructors"><span class="toc-number">9.2.</span> <span class="toc-text">Constructors and Destructors</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Constructors"><span class="toc-number">9.2.1.</span> <span class="toc-text">Constructors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Destructors"><span class="toc-number">9.2.2.</span> <span class="toc-text">Destructors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#this-Pointer"><span class="toc-number">9.3.</span> <span class="toc-text">this Pointer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#const-and-static-Members"><span class="toc-number">9.3.1.</span> <span class="toc-text">const and static Members</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-Variables"><span class="toc-number">9.3.2.</span> <span class="toc-text">const Variables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-Members"><span class="toc-number">9.3.3.</span> <span class="toc-text">const Members</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#static-members"><span class="toc-number">9.3.4.</span> <span class="toc-text">static members</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week10"><span class="toc-number">10.</span> <span class="toc-text">Week10</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BDOperator-overloading"><span class="toc-number">10.1.</span> <span class="toc-text">运算符重载Operator overloading</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#friend-Functions%E5%8F%8B%E5%85%83%E5%87%BD%E6%95%B0"><span class="toc-number">10.2.</span> <span class="toc-text">friend Functions友元函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-defined-Type-Conversion"><span class="toc-number">10.3.</span> <span class="toc-text">User-defined Type Conversion</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#operator-type"><span class="toc-number">10.3.1.</span> <span class="toc-text">operator type()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Converting-constructor"><span class="toc-number">10.3.2.</span> <span class="toc-text">Converting constructor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Assignment-operator-overloading"><span class="toc-number">10.3.3.</span> <span class="toc-text">Assignment operator overloading</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Increment-and-decrement-operators"><span class="toc-number">10.4.</span> <span class="toc-text">Increment and decrement operators</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week11"><span class="toc-number">11.</span> <span class="toc-text">Week11</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Some-Default-Operations"><span class="toc-number">11.1.</span> <span class="toc-text">Some Default Operations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Default-Constructors"><span class="toc-number">11.1.1.</span> <span class="toc-text">Default Constructors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Implicitly-defined-Destructor"><span class="toc-number">11.1.2.</span> <span class="toc-text">Implicitly-defined Destructor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Default-Copy-Constructors"><span class="toc-number">11.1.3.</span> <span class="toc-text">Default Copy Constructors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Default-Copy-Assignment"><span class="toc-number">11.1.4.</span> <span class="toc-text">Default Copy Assignment</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#An-Example-with-Dynamic-Memory"><span class="toc-number">11.2.</span> <span class="toc-text">An Example with Dynamic Memory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-1-Hard-Copy"><span class="toc-number">11.3.</span> <span class="toc-text">Solution 1: Hard Copy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-2-Soft-Copy"><span class="toc-number">11.4.</span> <span class="toc-text">Solution 2: Soft Copy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Smart-Pointers"><span class="toc-number">11.5.</span> <span class="toc-text">Smart Pointers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#std-shared-ptr"><span class="toc-number">11.5.1.</span> <span class="toc-text">std::shared_ptr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#std-unique-ptr"><span class="toc-number">11.5.2.</span> <span class="toc-text">std::unique_ptr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-Understand-Smart-Pointers"><span class="toc-number">11.5.3.</span> <span class="toc-text">How to Understand Smart Pointers</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week12"><span class="toc-number">12.</span> <span class="toc-text">Week12</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Improve-Your-Source-Code"><span class="toc-number">12.1.</span> <span class="toc-text">Improve Your Source Code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Derived-Classes%E6%B4%BE%E7%94%9F%E7%B1%BB"><span class="toc-number">12.2.</span> <span class="toc-text">Derived Classes派生类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Inheritance"><span class="toc-number">12.2.1.</span> <span class="toc-text">Inheritance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Constructors-1"><span class="toc-number">12.2.2.</span> <span class="toc-text">Constructors</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Destructors-1"><span class="toc-number">12.2.3.</span> <span class="toc-text">Destructors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Access-Control"><span class="toc-number">12.3.</span> <span class="toc-text">Access Control</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Public-Inheritance"><span class="toc-number">12.3.1.</span> <span class="toc-text">Public Inheritance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Protected-Inheritance"><span class="toc-number">12.3.2.</span> <span class="toc-text">Protected Inheritance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Private-Inheritance"><span class="toc-number">12.3.3.</span> <span class="toc-text">Private Inheritance</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Virtual-Functions"><span class="toc-number">12.4.</span> <span class="toc-text">Virtual Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Virtual-Destructors"><span class="toc-number">12.4.1.</span> <span class="toc-text">Virtual Destructors</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Inheritance-and-Dynamic-Memory-Allocation"><span class="toc-number">12.5.</span> <span class="toc-text">Inheritance and Dynamic Memory Allocation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week13"><span class="toc-number">13.</span> <span class="toc-text">Week13</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Class-Templates"><span class="toc-number">13.1.</span> <span class="toc-text">Class Templates</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Review-Function-Templates"><span class="toc-number">13.1.1.</span> <span class="toc-text">Review: Function Templates</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Different-Classes-for-Different-Type-Matrices"><span class="toc-number">13.1.2.</span> <span class="toc-text">Different Classes for Different Type Matrices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Class-Templates-1"><span class="toc-number">13.1.3.</span> <span class="toc-text">Class Templates</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Template-Non-Type-Parameters"><span class="toc-number">13.2.</span> <span class="toc-text">Template Non-Type Parameters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Class-Template-Specialization"><span class="toc-number">13.3.</span> <span class="toc-text">Class Template Specialization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#std-classes"><span class="toc-number">13.4.</span> <span class="toc-text">std classes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#std-basic-string"><span class="toc-number">13.4.1.</span> <span class="toc-text">std::basic_string</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#std-array"><span class="toc-number">13.4.2.</span> <span class="toc-text">std::array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-other-templates"><span class="toc-number">13.4.3.</span> <span class="toc-text">Some other templates</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week14"><span class="toc-number">14.</span> <span class="toc-text">Week14</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Standard-Output-Stream-and-Standard-Error-Stream"><span class="toc-number">14.1.</span> <span class="toc-text">Standard Output Stream and Standard Error Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stdin-stdout-stderr"><span class="toc-number">14.1.1.</span> <span class="toc-text">stdin, stdout, stderr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Output-Stream-and-Error-Stream"><span class="toc-number">14.1.2.</span> <span class="toc-text">Output Stream and Error Stream</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redirection"><span class="toc-number">14.1.3.</span> <span class="toc-text">Redirection</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#assert"><span class="toc-number">14.2.</span> <span class="toc-text">assert</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exceptions"><span class="toc-number">14.3.</span> <span class="toc-text">Exceptions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#More-About-Exceptions"><span class="toc-number">14.4.</span> <span class="toc-text">More About Exceptions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Stack-Unwinding"><span class="toc-number">14.4.1.</span> <span class="toc-text">Stack Unwinding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#std-exception"><span class="toc-number">14.4.2.</span> <span class="toc-text">std::exception</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exception-Specifications-and-noexcept"><span class="toc-number">14.4.3.</span> <span class="toc-text">Exception Specifications and noexcept</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nothrow-new"><span class="toc-number">14.4.4.</span> <span class="toc-text">nothrow new</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week15"><span class="toc-number">15.</span> <span class="toc-text">Week15</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Friend-Classes"><span class="toc-number">15.1.</span> <span class="toc-text">Friend Classes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#friend-Functions"><span class="toc-number">15.1.1.</span> <span class="toc-text">friend Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#friend-Classes"><span class="toc-number">15.1.2.</span> <span class="toc-text">friend Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#friend-Member-Functions"><span class="toc-number">15.1.3.</span> <span class="toc-text">friend Member Functions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nested-Types"><span class="toc-number">15.2.</span> <span class="toc-text">Nested Types</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nested-Enumerations-C-11"><span class="toc-number">15.2.1.</span> <span class="toc-text">Nested Enumerations (C++11)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nested-Classes"><span class="toc-number">15.2.2.</span> <span class="toc-text">Nested Classes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nested-Types-Scope"><span class="toc-number">15.2.3.</span> <span class="toc-text">Nested Types: Scope</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RTTI-and-Type-Cast-Operators"><span class="toc-number">15.3.</span> <span class="toc-text">RTTI and Type Cast Operators</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#typeid"><span class="toc-number">15.3.1.</span> <span class="toc-text">typeid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dynamic-cast"><span class="toc-number">15.3.2.</span> <span class="toc-text">dynamic_cast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#More-Type-Cast-Operators"><span class="toc-number">15.3.3.</span> <span class="toc-text">More Type Cast Operators</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/img/1676641492749-1024x640.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2015 - 2025 By HUII</div><div class="footer_custom_text"><span>备案号：<a href="https://beian.miit.gov.cn/" target="_blank">闽ICP备18005042号-2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: 'ce436d2d4a3e549dad64',
      clientSecret: '9a40a66c694e77b58120d1b62b2dcee193963143',
      repo: 'huiiz.github.io',
      owner: 'huiiz',
      admin: ['huiiz'],
      id: '4670dd671e70812ef692683ac7178178',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
    getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.textContent= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><div style="display:none;"><script type="text/javascript" src="https://v1.cnzz.com/z_stat.php?id=1279897347&web_id=1279897347"></script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>